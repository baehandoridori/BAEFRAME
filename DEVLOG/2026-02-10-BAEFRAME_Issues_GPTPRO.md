# BAEFRAME 교차검증 이슈 요약 (표 + 짧은 줄글)

> 이 문서는 “긴 보고서” 대신, **릴리즈 판단에 필요한 정보만** 짧게 모았습니다.  
> 기준: `BAEFRAME.zip` 코드 스냅샷

---

## 1) 핵심 결론 (3줄 요약)

- 지금 가장 큰 리스크는 **저장 안정성(파일 손상/유실)**과 **동기화 병합(남이 한 수정이 사라짐)** 입니다. → 🔴 [01]~[04]  
- 장시간(8시간) 사용 시 **메모리 누적/메인 스레드 블로킹**으로 버벅임이 커질 가능성이 높습니다. → 🟠 [08]~[11]  
- 보안은 “취약점 하나”보다 “연결”이 위험합니다. 앱 내부의 `innerHTML` + IPC 경로 검증 부재가 **체인**이 됩니다. → 🔴 [06] + 🟠 [27]

---

## 2) 위기 수준 4단계 정의

| 수준 | 명칭 | 의미(일반인 버전) |
|---|---|---|
| 🔴 1단계 | 긴급 (Critical) | 작업 유실/파일 손상/앱 종료 불가 같은 “즉시 봉합” |
| 🟠 2단계 | 심각 (High) | 주요 기능 장애 또는 장시간 사용 시 심각한 성능 저하 |
| 🟡 3단계 | 주의 (Medium) | 특정 상황에서 오작동/운영 리스크 |
| 🟢 4단계 | 경미 (Low) | 품질/유지보수 이슈(누적되면 위험) |

---

## 3) 통계(이 문서 ID 기준)

| 위기 수준 | 건수 |
|---|---:|
| 🔴 1단계 | 6 |
| 🟠 2단계 | 10 |
| 🟡 3단계 | 5 |
| 🟢 4단계 | 6 |
| **합계** | **27** |

---

## 4) Claude 문서(기존 코드리뷰)와의 비교 요약

- Claude 문서는 문제를 많이 잡았지만, **경로/파일 구조 오기**(`main/schema.js` vs `shared/schema.js`)가 섞여 있고, 일부는 **이미 해결된 항목을 계속 이슈로 분류**했습니다.
- 반대로 실제로 가장 위험한 “데이터 유실 체인”은 **부분만 맞거나(3.2)** 핵심을 놓친 항목이 있습니다(🔴 [02],[03],[06]).

---

## 5) 릴리즈 전 “가장 먼저” 고칠 TOP 5

1. 🔴 **[01] 저장 큐 + 원자적 저장(temp→rename)**  
2. 🔴 **[02] 동기화 병합 설계 보강(원격 최신 보호/영역별 dirty 분리)**  
3. 🔴 **[04] 손상 파일 로드 복구(.bak 탐색/격리/안내)**  
4. 🔴 **[06] innerHTML 제거 + IPC 경로/확장자 제한**  
5. 🟠 **[08] 드로잉 이미지 캐시 제한(LRU 등)**

---

# 6) 이슈 목록 (4단계 테이블)

> 표의 “코멘트”는 **무엇/왜/어떻게**를 짧게 압축했고, “영향”은 비개발자 관점으로 썼습니다.

---

## 🔴 1단계 긴급

| ID | 제목 | 영역 | 코드 위치(예) | 코멘트(무엇/왜/어떻게) | 영향(일반인) | Claude 문서 비교 |
|---:|---|---|---|---|---|---|
| 01 | 저장 겹침 + 비원자적 저장 → 파일 손상 | A/C | `review-data-manager.js` L685~712<br>`ipc-handlers.js` L44~74 | 무엇: 저장이 겹칠 수 있음<br>왜: 락/원자적 저장 없음<br>어떻게: 자동저장+수동저장+Undo/Redo 연쇄 | `.bframe` 깨짐 → 열기 실패 → 작업 유실 | 3.2 **언급(부분)**: await 근거 일부 오판, 핵심 위험은 실제 |
| 02 | 원격(Drive) 최신 변경 보호 실패 | A | `review-data-manager.js` L261~275<br>L165~172 | 무엇: 원격 최신을 보호 못 함<br>왜: localModified가 거의 now로 잡힘<br>어떻게: 남이 저장 후 내가 저장 | 동기화 중 “남이 한 수정이 사라짐” | **누락**(핵심 병합 결함 미포착) |
| 03 | reloadAndMerge가 미저장 작업을 덮어씀 | A | `review-data-manager.js` L416~436 | 무엇: 파일 변경 감지 시 덮어쓰기 가능<br>왜: 편집 중(isDirty) 고려 부족<br>어떻게: 작업 중 Drive 갱신 | 그리던 드로잉이 갑자기 사라짐 | **누락** |
| 04 | JSON 손상/파싱 실패 시 복구 없음 | A | `ipc-handlers.js` L15~38 | 무엇: parse 실패 시 즉시 실패<br>왜: `.bak` 자동 복구 없음<br>어떻게: 저장 중 크래시/동기화 충돌 | 손상 파일 = 접근 불가(사실상 유실) | 4.13 **언급(정확)** |
| 05 | 렌더러 응답 없으면 종료 무한 대기 | C/D | `main/index.js` L298~323 | 무엇: 종료 시 renderer 응답 대기<br>왜: 타임아웃/폴백 없음<br>어떻게: 렌더러 멈춘 상태 | 앱이 안 꺼짐→강제 종료→저장 누락 | 3.4 **언급(부분)** |
| 06 | 앱 내부 XSS + IPC 경로 검증 부재(체인) | E/A | `renderer/app.js` L5094~5141<br>L5319~5331 | 무엇: innerHTML로 실행 가능<br>왜: escape 부재 + saveReview 경로 제한 없음<br>어떻게: 악성 .bframe 열기 | 의도치 않은 동작/파일 훼손 가능 | **부분**: web-viewer 중심, 앱 내부+IPC 체인은 누락 |

---

## 🟠 2단계 심각

| ID | 제목 | 영역 | 코드 위치(예) | 코멘트(무엇/왜/어떻게) | 영향(일반인) | Claude 문서 비교 |
|---:|---|---|---|---|---|---|
| 07 | 드로잉 Undo/Redo 오류 | D | `drawing-manager.js` L283~318 | 무엇: redo가 단계 건너뜀<br>왜: 인덱스 적용 순서 불일치<br>어떻게: Undo→Redo 반복 | 되돌리기 신뢰 붕괴 | 3.1 **언급(정확)** |
| 08 | 드로잉 이미지 캐시 무제한 | B | `drawing-manager.js` L686~720 | 무엇: 캐시 상한 없음<br>왜: LRU/정리 부재<br>어떻게: 프레임 훑기 반복 | 오래 쓰면 느려짐/멈춤 | 4.6 **언급(정확)** |
| 09 | 메인 JSON parse/stringify 동기 실행 | B/C | `ipc-handlers.js` L15~38<br>L44~74 | 무엇: 큰 파일에서 프리즈<br>왜: 메인이 CPU를 오래 점유<br>어떻게: 드로잉/이미지 많을 때 | 저장/로드 때 “뚝 멈춤” | **누락** |
| 10 | FFmpeg 캐시 정리 sync I/O + 에러 무시 | B/C | `ffmpeg-manager.js` L670~744 | 무엇: 캐시 정리 중 프리즈/실패 묻힘<br>왜: sync fs 다수 + catch로 묵음<br>어떻게: 캐시 증가 후 실행 | 갑자기 버벅임/디스크 증가 | 4.17/4.18 **언급(정확)** |
| 11 | 파일 watch 정리 누락(누적) | B/A | `ipc-handlers.js` L117~250 | 무엇: 전환 시 watch 남음<br>왜: renderer stop 호출 부재<br>어떻게: 여러 샷 열기 | 오래 켜두면 점점 무거움 | 4.20 **언급(부분)** |
| 12 | 딥링크 프로토콜 불일치 | D | `open.html` L194~200<br>`main/index.js` L205~222 | 무엇: URL 형식 다름<br>왜: main이 query 미지원<br>어떻게: 웹에서 앱 열기 | “열기” 실패 | 6.1 **언급(정확)** |
| 13 | 크래시/무응답 복구 UX 부족 | D | `main/window.js` L179~202 | 무엇: 사용자 안내/복구 없음<br>왜: 이벤트 처리 UX 미구현<br>어떻게: 렌더러 죽음/멈춤 | 사용자는 “그냥 멈춤”만 봄 | 4.11/4.12 **언급(정확)** |
| 14 | Slack 확인 execSync(메인 블로킹) | C/B | `ipc-handlers.js` L1034~1050 | 무엇: 동기 시스템 호출<br>왜: execSync가 루프 차단<br>어떻게: 시스템 지연 시 | 순간 멈춤 | 4.16 **언급(정확)** |
| 15 | save() await 누락 경로 존재 | A/C | `renderer/app.js` 다수 | 무엇: 저장 완료 전 다음 동작<br>왜: fire-and-forget<br>어떻게: 연속 편집/Undo | 저장 겹침 위험 증가 | 3.2/4.8 **언급(부분)** |
| 27 | web-viewer author XSS | E | `web-viewer/app.js` L1820~1827 | 무엇: 텍스트가 코드 실행 가능<br>왜: innerHTML + 미이스케이프<br>어떻게: 악성 데이터 포함 공유 | 공유 페이지 신뢰 훼손 | 6.4 **언급(정확)** |

---

## 🟡 3단계 주의

| ID | 제목 | 영역 | 코드 위치(예) | 코멘트(무엇/왜/어떻게) | 영향(일반인) | Claude 문서 비교 |
|---:|---|---|---|---|---|---|
| 16 | 댓글 이미지 유령 첨부 | D | `comment-manager.js` L360~469 | 무엇: 취소해도 이미지가 남음<br>왜: pendingImage 정리 누락<br>어떻게: 첨부→취소→다음 댓글 | 엉뚱한 이미지가 붙음 | 3.3 **언급(대체로 맞음)** |
| 17 | copyFile/deleteFile IPC 미구현 | A | `review-data-manager.js` L328~357 | 무엇: 호출은 있는데 API 없음<br>왜: preload/main 미노출<br>어떻게: 백업/정리 경로 | 백업/정리가 기대대로 안 됨 | 6.3 **언급(정확)** |
| 18 | validators NaN/Infinity 및 replies 검증 부족 | A | `shared/validators.js` L131 등 | 무엇: 이상 값이 통과 가능<br>왜: typeof number만 검사<br>어떻게: 외부/손상 파일 | UI 깨짐/오작동 | 4.24/5.3 **언급(경로 오기)** |
| 19 | watch 오류 사용자 미통지 | A/D | `ipc-handlers.js` L164~174 | 무엇: 감시 중단을 모름<br>왜: 로그만 기록<br>어떻게: 권한/Drive 문제 | 동기화 끊겨도 모름 | 4.14 **언급(정확)** |
| 20 | FFmpeg kill/timeout 스트림 정리 불명확 | B | `ffmpeg-manager.js` L496~506 | 무엇: 자원 정리 모호<br>왜: destroy 명시 없음<br>어떻게: 실패 반복 | 누적 시 성능 저하 가능 | 3.8 **언급(과장/부분)** |

---

## 🟢 4단계 경미

| ID | 제목 | 영역 | 코드 위치(예) | 코멘트(무엇/왜/어떻게) | 영향(일반인) | Claude 문서 비교 |
|---:|---|---|---|---|---|---|
| 21 | 영상 비율 0 나누기 가능 | D | `video-player.js` L530~536 | 무엇: height=0이면 Infinity<br>왜: 가드 없음<br>어떻게: 일부 파일/메타 | 레이아웃 깨짐 가능 | 4.2/5.2 **언급(정확)** |
| 22 | canvas null 체크 없음 | D | `drawing-canvas.js` L35 전후 | 무엇: 없으면 예외<br>왜: 가드 부족<br>어떻게: 로딩/DOM 상태 | 특정 상황 크래시 | 4.1 **언급(정확)** |
| 23 | preload 리스너 중복 가능 | E | `preload.js` L98~121 | 무엇: on 중심, 해제 불명확<br>왜:: 패턴 혼재<br>어떻게: 재초기화 시 | 이벤트 중복 가능 | 4.22 **언급(정확)** |
| 24 | 마이그레이션 오류 처리 일관성 부족 | A | `shared/schema.js` (다수) | 무엇: 어떤 건 초기화, 어떤 건 경고만<br>왜: 정책 혼재<br>어떻게: 구버전/손상 파일 | 지원/QA 난이도 증가 | 4.23/5.4 **언급(경로 오기)** |
| 25 | timeline.destroy 리스너 정리 없음 | B | `timeline.js` L2138~2161 | 무엇: removeEventListener 누락<br>왜: destroy가 최소 구현<br>어떻게: 재생성 시 | 잠재 누수 | 6.2 **언급(정확)** |
| 26 | logger 실패 상위 전파 없음 | B | `logger.js` L101~108 | 무엇: 실패를 앱이 모름<br>왜: console.error로 종료<br>어떻게: 권한/디스크 | 문제 원인 파악 어려움 | 4.21 **언급(정확)** |

---

## 7) 빌드 권장
- [ ] 즉시 빌드 가능  
- [ ] 일부 수정 후 빌드 권장  
- [x] **심각한 문제 해결 후 빌드 필요** (🔴 1단계 우선)

