# BAEFRAME 코드 심층 분석 보고서

> 분석일: 2026-01-16
> 분석 대상: BAEFRAME 전체 코드베이스

---

## 요약

| 심각도 | 발견 건수 | 설명 |
|--------|----------|------|
| 🔴 심각 | 10건 | 앱 크래시, 데이터 손실 가능. 즉시 수정 필요 |
| 🟡 주의 | 25건 | 기능 오작동, 성능 저하 가능. 조속히 수정 권장 |
| 🟢 경미 | 4건 | 사용성 개선 필요. 향후 개선 권장 |

---

## 🔴 심각 (Critical) - 즉시 수정 필요

앱이 멈추거나, 작업한 데이터가 사라지거나, 프로그램이 종료되지 않는 등 치명적인 문제를 일으킬 수 있습니다.

| # | 문제 | 위치 | 쉬운 설명 | 결과 | 상태 |
|---|------|------|----------|------|------|
| 1 | Redo 버튼 버그 | drawing-manager.js:314-316 | 그림을 되돌린 후 "다시 실행"하면 잘못된 위치에서 데이터를 읽음 | 그리기 도구 사용 중 화면이 하얗게 되거나 그린 내용이 사라짐 | ⬜ 대기 |
| 2 | 자동저장 충돌 | review-data-manager.js:693-710 | 짧은 시간에 여러 번 저장하면 저장 순서가 꼬임 | 댓글이나 그림이 저장 안 되고 사라질 수 있음 | ⬜ 대기 |
| 3 | 댓글 이미지 손실 | app.js:839,856 | 댓글에 첨부한 이미지 정보가 여러 곳에서 따로 관리됨 | 댓글에 이미지가 중복 첨부되거나 안 붙음 | ⬜ 대기 |
| 4 | 앱 종료 불가 | index.js:316-321 | 앱 종료 시 화면(Renderer)이 응답 안 하면 무한 대기 | X 버튼 눌러도 앱이 안 꺼짐, 작업관리자로 강제종료 필요 | ⬜ 대기 |
| 5 | UI 멈춤 (파일 처리) | ffmpeg-manager.js:321,332,381,393,394,446 | 파일 정보 확인을 "기다리는 방식"으로 처리함 | 큰 파일(2GB+) 열 때 화면이 1~5초 멈춤 | ⬜ 대기 |
| 6 | UI 멈춤 (설정 저장) | ipc-handlers.js:524-526, 678-679 | 폴더 생성을 "기다리는 방식"으로 처리함 | 썸네일 100개 저장 시 화면이 수 초 멈춤 | ⬜ 대기 |
| 7 | 창 표시 충돌 | window.js:147-154 | 5초 타임아웃과 로딩 완료 이벤트가 동시에 발생할 수 있음 | 앱 시작 시 창이 두 번 깜빡이거나 예상 못 한 상태 | ⬜ 대기 |
| 8 | FFmpeg 좀비 프로세스 | ffmpeg-manager.js:497-500 | 영상 변환 취소 후 프로세스가 완전히 정리 안 됨 | 메모리 사용량이 계속 증가, 오래 쓰면 앱이 느려짐 | ⬜ 대기 |
| 9 | 과거 파일 데이터 손실 | schema.js:252, 306-314 | 예전 버전 .bframe 파일 열 때 잘못된 형식의 데이터를 빈 값으로 바꿈 | 예전에 작업한 하이라이트나 그림이 사라짐 (경고 없이) | ⬜ 대기 |
| 10 | 검증 없이 저장 | validators.js:21-79 | 데이터 검증 결과를 무시하고 저장할 수 있음 | 손상된 데이터가 저장되어 나중에 파일이 안 열림 | ⬜ 대기 |

---

## 🟡 주의 (Warning) - 조속히 수정 권장

특정 상황에서 기능이 제대로 작동하지 않거나, 성능이 저하되거나, 사용자에게 혼란을 줄 수 있습니다.

| # | 문제 | 위치 | 쉬운 설명 | 결과 | 상태 |
|---|------|------|----------|------|------|
| 1 | 캔버스 초기화 실패 | drawing-canvas.js:31 | 캔버스가 준비 안 된 상태에서 그리기 시도 가능 | 창 크기 조절 중 그리면 에러 발생 | ⬜ 대기 |
| 2 | 영상 비율 오류 | video-player.js:530 | 영상 로딩 중 가로/세로가 0일 때 무한대 값 계산 | 영상이 찌그러져 보일 수 있음 | ⬜ 대기 |
| 3 | 날짜 파싱 오류 | review-data-manager.js:261-262 | 날짜 정보가 없는 파일에서 NaN 값 발생 | 파일 병합 시 데이터가 잘못 합쳐질 수 있음 | ⬜ 대기 |
| 4 | 탐색 플래그 오류 | video-player.js:376-396 | 빠르게 영상 위치를 이동하면 플래그 처리가 꼬임 | 타임라인 드래그 시 프레임 숫자가 흔들림 | ⬜ 대기 |
| 5 | 레이어 ID 충돌 | drawing-layer.js:75-87 | 여러 파일을 빠르게 열면 레이어 번호가 겹칠 수 있음 | 다른 파일의 그림이 잘못된 레이어에 저장됨 | ⬜ 대기 |
| 6 | 이미지 캐시 무한 증가 | drawing-manager.js:686-706 | 그리기 이미지가 메모리에 계속 쌓임 | 긴 영상 작업 시 앱이 점점 느려짐 | ⬜ 대기 |
| 7 | 이벤트 리스너 누수 | drawing-canvas.js:73-85 | 캔버스 교체 시 이전 이벤트가 정리 안 됨 | 창 크기 자주 바꾸면 메모리 누수 | ⬜ 대기 |
| 8 | Undo 저장 누락 | app.js:629-658 | 실행취소 시 저장 완료를 기다리지 않음 | Undo 후 바로 Redo하면 데이터 불일치 | ⬜ 대기 |
| 9 | 레이어 UI 미갱신 | drawing-manager.js:754-768 | 파일 초기화 시 타임라인 UI 갱신이 보장 안 됨 | 새 파일 열 때 이전 레이어가 보일 수 있음 | ⬜ 대기 |
| 10 | 로딩창 미닫힘 | index.js:157-163 | 파일 로드 실패 시 로딩 창 닫기 누락 | 에러 시 로딩 화면이 계속 떠 있음 | ⬜ 대기 |
| 11 | 렌더러 크래시 미복구 | window.js:172-175 | 화면 프로세스 크래시 후 복구 안 됨 | 메모리 부족 시 앱이 먹통 | ⬜ 대기 |
| 12 | 응답없음 미알림 | window.js:177-180 | 앱이 멈춰도 사용자에게 알리지 않음 | 사용자가 어떻게 해야 할지 모름 | ⬜ 대기 |
| 13 | JSON 손상 미복구 | ipc-handlers.js:81-93 | 손상된 .bframe 파일 열 때 복구 시도 없음 | "오류 발생" 메시지만 나오고 파일을 못 염 | ⬜ 대기 |
| 14 | 파일 감시 실패 미알림 | ipc-handlers.js:160-181 | 파일 변경 감시 실패해도 알리지 않음 | 다른 사람이 파일 수정해도 알 수 없음 | ⬜ 대기 |
| 15 | 프로토콜 링크 실패 | index.js:229 | baeframe:// 링크 열기 성공/실패 확인 안 함 | Slack 링크 클릭해도 파일이 안 열리지만 에러 없음 | ⬜ 대기 |
| 16 | Slack 연동 멈춤 | ipc-handlers.js:1034-1050 | Slack 정보 확인 시 동기 방식 사용 | Slack 응답 느리면 UI 5초 이상 멈춤 | ⬜ 대기 |
| 17 | 캐시 정리 실패 무시 | ffmpeg-manager.js:558 | 캐시 정리 실패해도 무시함 | 캐시가 계속 쌓여 디스크 용량 부족 | ⬜ 대기 |
| 18 | 캐시 정리 중 멈춤 | ffmpeg-manager.js:665-708 | 큰 캐시 정리 시 동기 방식 사용 | 50GB 캐시 정리 시 UI 수 초 멈춤 | ⬜ 대기 |
| 19 | 개별 취소 불가 | ffmpeg-manager.js:632-638 | 여러 영상 변환 중 하나만 취소 불가능 | 여러 개 변환 시 모두 취소해야 함 | ⬜ 대기 |
| 20 | 파일 감시 메모리 누수 | ipc-handlers.js:149-150 | 파일 감시 정리 실패 시 메모리 누적 | 오래 사용하면 메모리 사용량 증가 | ⬜ 대기 |
| 21 | 로그 저장 실패 무시 | logger.js:100-102 | 로그 저장 실패해도 콘솔에만 출력 | 문제 발생 시 원인 파악 어려움 | ⬜ 대기 |
| 22 | 이벤트 리스너 중복 | preload.js:99-110 | 같은 이벤트 핸들러 여러 번 등록 가능 | 파일 변경 시 같은 동작이 여러 번 실행 | ⬜ 대기 |
| 23 | 오류 처리 불일치 | schema.js:180-197, 214-226 | 함수마다 오류 처리 방식이 다름 | 일부 오류가 제대로 잡히지 않음 | ⬜ 대기 |
| 24 | NaN 검증 누락 | validators.js:155, 261-264 | 숫자 필드에 NaN이 들어와도 통과 | 타임라인에서 댓글 위치가 이상해짐 | ⬜ 대기 |
| 25 | 타입 검증 없음 | preload.js:11-65 | API 호출 시 파라미터 타입 검증 안 함 | 잘못된 타입 전달 시 에러 발생 | ⬜ 대기 |

---

## 🟢 경미 (Minor) - 향후 개선 권장

당장 문제가 되지는 않지만, 코드 품질과 사용성 향상을 위해 개선하면 좋습니다.

| # | 문제 | 위치 | 쉬운 설명 | 결과 | 상태 |
|---|------|------|----------|------|------|
| 1 | API 패턴 불일치 | preload.js:70 | 일부 API만 다른 방식 사용 | 개발자가 API 사용법 헷갈림 | ⬜ 대기 |
| 2 | 영상 비율 0 처리 | video-player.js:526-532 | 영상 크기 0일 때 처리 없음 | 로딩 중 계산 오류 가능 | ⬜ 대기 |
| 3 | 중첩 검증 누락 | validators.js:151-174 | 답글의 내부 구조 검증 안 함 | 답글에 잘못된 데이터 저장 가능 | ⬜ 대기 |
| 4 | 선택 필드 불명확 | validators.js:157-161 | 어떤 필드가 선택인지 명확하지 않음 | 개발 시 혼란 | ⬜ 대기 |

---

## 수정 우선순위 권장

### 1단계: 즉시 수정 (데이터 손실/앱 크래시 방지)

| 우선순위 | 문제 | 수정 방안 |
|---------|------|----------|
| 1 | Redo 버그 | 인덱스 계산 오류 수정 |
| 2 | 자동저장 충돌 | 저장 완료 대기 로직 추가 |
| 3 | 앱 종료 불가 | 타임아웃 추가 (30초) |
| 4 | 동기 FS 호출 | 모두 비동기(fs.promises)로 변경 |

### 2단계: 조속히 수정 (안정성 향상)

| 우선순위 | 문제 | 수정 방안 |
|---------|------|----------|
| 1 | FFmpeg 프로세스 정리 | 로직 강화 |
| 2 | 이미지 캐시 | LRU 정책 적용 |
| 3 | 파일 검증 결과 | 필수 확인 로직 |

### 3단계: 개선 (사용성 향상)

| 우선순위 | 문제 | 수정 방안 |
|---------|------|----------|
| 1 | 렌더러 크래시 | 자동 복구 |
| 2 | 에러 메시지 | 사용자 친화적으로 개선 |
| 3 | API 타입 검증 | 추가 |

---

## 상세 분석

### 🔴 심각 #1: Redo 버튼 버그

**위치**: `renderer/scripts/modules/drawing-manager.js:314-316`

**문제 코드**:
```javascript
redo() {
  if (this.currentHistoryIndex < this.history.length - 1) {
    this.currentHistoryIndex++;
    // 인덱스가 증가된 후 잘못된 위치의 데이터를 참조할 수 있음
  }
}
```

**원인**: Undo 후 새로운 그리기 작업을 하면 기존 히스토리가 잘려야 하는데, Redo 시 잘린 부분을 참조하려고 시도함

**해결 방안**:
- 히스토리 배열 경계 검사 강화
- 새 작업 시 히스토리 뒤쪽 데이터 명시적 삭제

---

### 🔴 심각 #2: 자동저장 충돌

**위치**: `renderer/scripts/modules/review-data-manager.js:693-710`

**문제 코드**:
```javascript
async autoSave() {
  // 이전 저장이 완료되기 전에 새 저장 시작 가능
  this.saveData();
}
```

**원인**: 저장 완료를 기다리지 않고 다음 저장 시작

**해결 방안**:
- 저장 중 플래그 추가
- 저장 완료 대기 후 다음 저장 시작
- 또는 디바운스 적용

---

### 🔴 심각 #3: 댓글 이미지 손실

**위치**: `renderer/scripts/app.js:839,856`

**문제**: 댓글의 이미지 첨부 상태가 여러 곳에서 독립적으로 관리됨

**해결 방안**:
- 단일 진실 공급원(Single Source of Truth) 패턴 적용
- 이미지 상태를 한 곳에서만 관리

---

### 🔴 심각 #4: 앱 종료 불가

**위치**: `main/index.js:316-321`

**문제 코드**:
```javascript
app.on('before-quit', async (e) => {
  e.preventDefault();
  await cleanup(); // 무한 대기 가능
  app.quit();
});
```

**해결 방안**:
```javascript
app.on('before-quit', async (e) => {
  e.preventDefault();
  const timeout = setTimeout(() => app.exit(0), 30000);
  await cleanup();
  clearTimeout(timeout);
  app.quit();
});
```

---

### 🔴 심각 #5, #6: UI 멈춤 (동기 파일 처리)

**위치**:
- `main/ffmpeg-manager.js:321,332,381,393,394,446`
- `main/ipc-handlers.js:524-526, 678-679`

**문제**: `fs.existsSync`, `fs.mkdirSync` 등 동기 함수 사용

**해결 방안**:
```javascript
// Before
if (fs.existsSync(path)) { ... }

// After
if (await fs.promises.access(path).then(() => true).catch(() => false)) { ... }
```

---

### 🔴 심각 #7: 창 표시 충돌

**위치**: `main/window.js:147-154`

**문제**: 5초 타임아웃과 `ready-to-show` 이벤트가 경쟁 상태

**해결 방안**:
- 한 번만 실행되도록 플래그 추가
- 또는 `once` 이벤트 사용 후 타임아웃 정리

---

### 🔴 심각 #8: FFmpeg 좀비 프로세스

**위치**: `main/ffmpeg-manager.js:497-500`

**문제**: 프로세스 종료 시 stdin/stdout/stderr 스트림 정리 누락

**해결 방안**:
```javascript
process.stdin?.destroy();
process.stdout?.destroy();
process.stderr?.destroy();
process.kill('SIGKILL');
```

---

### 🔴 심각 #9: 과거 파일 데이터 손실

**위치**: `main/schema.js:252, 306-314`

**문제**: 마이그레이션 시 잘못된 형식의 데이터를 경고 없이 빈 배열로 대체

**해결 방안**:
- 데이터 손실 전 사용자에게 경고
- 백업 파일 자동 생성
- 마이그레이션 실패 시 원본 유지

---

### 🔴 심각 #10: 검증 없이 저장

**위치**: `main/validators.js:21-79`

**문제**: 검증 함수가 결과를 반환하지만 호출부에서 무시 가능

**해결 방안**:
- 검증 실패 시 예외 던지기
- 또는 저장 전 검증 필수화

---

## 참고사항

- 이 분석은 정적 코드 분석 기반이며, 실제 런타임 테스트로 추가 검증 필요
- 일부 문제는 특정 조건에서만 발생할 수 있음
- 수정 시 기존 기능에 영향이 없는지 반드시 테스트 필요
