# BAEFRAME 코드 리뷰 검증 리포트

> 작성일: 2026-01-13
> 검토자: Claude (GPT 리뷰 + 다른 Claude 세션 결과 통합 검증)
> 목적: 빌드 전 최종 리뷰

---

## 🚀 해결 진척도 (2026-01-14 업데이트)

### 📊 전체 현황

| 구분 | 완료 | 미완료 | 진행률 |
|:----:|:----:|:------:|:------:|
| 🔴 심각 | 2 | 1 | 67% |
| 🟠 높음 | 1 | 2 | 33% |
| 🟡 중간 | 10 | 1 | 91% |
| **전체** | **13** | **4** | **76%** |

```
전체 진행률 ███████████████████░░░░ 76%
```

---

### 📋 전체 문제 목록

| # | 문제 | 쉬운 설명 | 심각도 | 상태 | 출처 |
|:-:|------|----------|:------:|:----:|:----:|
| 1 | 프로토콜 URL 미스매치 | 웹에서 "앱으로 열기" 버튼이 작동 안 함 | 🔴 심각 | ✅ | 리뷰 |
| 2 | 캔버스 무한 렌더링 | 그리기 모드에서 앱이 멈추거나 느려짐 | 🔴 심각 | ✅ | 리뷰 |
| 3 | 댓글 성능 최적화 | 댓글이 너무 많으면 앱이 느려질 수 있음 | 🔴 심각 | ⬜ | 리뷰 |
| 4 | resize 이벤트 과다 | 창 크기 변경 시 앱이 버벅거림 | 🟠 높음 | ✅ | 리뷰 |
| 5 | 파일 경로 검증 누락 | 악성 파일 경로로 보안 문제 가능 | 🟠 높음 | ⬜ | 리뷰 |
| 6 | 파일 복사/삭제 API | 일부 파일 작업이 안 됨 | 🟠 높음 | ⬜ | 리뷰 |
| 7 | video.play() 에러 | 영상 재생 시 가끔 콘솔에 에러 표시 | 🟡 중간 | ✅ | 리뷰 |
| 8 | validators.js 미사용 | 데이터 검증 코드가 실제로 안 쓰임 | 🟡 중간 | ⬜ | 리뷰 |
| 9 | wheel passive 경고 | 타임라인 스크롤 시 브라우저 경고 | 🟡 중간 | ✅ | 리뷰 |
| 10 | 마커 드래그 이동 | 댓글 마커를 드래그로 위치 변경 | 🟡 중간 | ✅ | #72 |
| 11 | 구간 이동 기능 | 댓글/하이라이트 클릭 시 해당 구간으로 이동 | 🟡 중간 | ✅ | #72 |
| 12 | .bframe 자동 생성 | 공유 시 리뷰 파일 자동 생성 | 🟡 중간 | ✅ | #70 |
| 13 | 댓글 클릭 버그 | 댓글 클릭이 가끔 안 됨 | 🟡 중간 | ✅ | 버그 |
| 14 | 마커 툴팁/호버 버그 | 마커 말풍선이 안 보이거나 구간 밖에서도 반응 | 🟡 중간 | ✅ | 버그 |
| 15 | 마커 위치 자동저장 | 마커 이동 후 저장버튼 없이 자동 저장 | 🟡 중간 | ✅ | #70 |
| 16 | 그리기 레이어 격자 | 레이어에 별도 격자무늬가 생성됨 | 🟡 중간 | ✅ | #72 |
| 17 | 그리기 레이어 투명도 | 레이어 칸이 투명 → 불투명 변경 필요 | 🟡 중간 | ✅ | #72 |

---

### ✅ 완료된 항목 상세

| # | 문제 | 해결 방법 | 해결일 |
|:-:|------|----------|:------:|
| 1 | 프로토콜 미스매치 | URL 파싱 로직 통일 | 01-13 |
| 2 | 캔버스 무한 렌더링 | requestAnimationFrame 중복 호출 방지 | 01-13 |
| 4 | resize 과다 호출 | 디바운싱 적용 | 01-13 |
| 7 | video.play() 에러 | Promise catch 처리 추가 | 01-14 |
| 9 | wheel passive | addEventListener에 옵션 추가 | 01-14 |
| 10 | 마커 드래그 | mousedown/move/up 이벤트 구현 | 01-14 |
| 11 | 구간 이동 | 클릭 시 videoPlayer.seekToFrame 호출 | 01-13 |
| 12 | .bframe 자동 생성 | 공유 전 reviewDataManager.save 호출 | 01-13 |
| 13 | 댓글 클릭 버그 | 이벤트 버블링 및 조건문 수정 | 01-13 |
| 14 | 마커 툴팁 버그 | 툴팁 body 이동, 프레임 범위 체크 추가 | 01-14 |
| 15 | 마커 위치 자동저장 | reviewDataManager.save() 직접 호출 | 01-14 |
| 16 | 그리기 레이어 격자 | _applyGridBackground() 호출 제거 | 01-14 |
| 17 | 그리기 레이어 투명도 | keyframe-range-bar 투명도 25%→69% | 01-14 |

---

### ⬜ 미완료 항목

| # | 문제 | 필요 작업 | 우선순위 |
|:-:|------|----------|:--------:|
| 3 | 댓글 성능 최적화 | 가상 스크롤 구현 (Virtual Scrolling) | 높음 |
| 5 | 파일 경로 검증 | IPC 핸들러에 경로 검증 로직 추가 | 중간 |
| 6 | 파일 API 추가 | preload에 copyFile, deleteFile 추가 | 낮음 |
| 8 | validators 적용 | review-data-manager에서 검증 함수 사용 | 낮음 |

---

## 개요

GPT 코드 리뷰와 다른 Claude 세션의 검증 결과를 실제 코드베이스와 대조하여 최종 검증한 문서입니다.
각 항목의 **유효성**, **실제 위험도**, **일반인도 이해할 수 있는 설명**을 포함합니다.

---

## 심각도 범례

| 배지 | 의미 | 설명 |
|------|------|------|
| 🔴 **심각** | 즉시 수정 필요 | 앱 크래시, 데이터 손실, 기능 완전 불가 |
| 🟠 **높음** | 조속한 수정 권장 | 메모리 누수, 성능 저하, 부분 기능 장애 |
| 🟡 **중간** | 개선 권장 | 사용성 문제, 잠재적 버그 |
| 🟢 **낮음** | 장기 개선 | 코드 품질, 유지보수성 |

---

## 검증 결과 요약

| 분류 | 전체 | 🔴 심각 | 🟠 높음 | 🟡 중간 | 🟢 낮음 |
|------|------|---------|---------|---------|---------|
| 에러 처리 & 안정성 | 7 | 1 | 2 | 3 | 1 |
| 성능 & 최적화 | 7 | 2 | 2 | 3 | 0 |
| 코드 품질 | 5 | 0 | 1 | 2 | 2 |
| Electron 보안 | 4 | 0 | 1 | 2 | 1 |
| 아키텍처 | 3 | 0 | 0 | 2 | 1 |
| **합계** | **26** | **3** | **6** | **12** | **5** |

---

## 1. 에러 처리 & 안정성

### 1.1 🔴 baeframe:// 프로토콜 미스매치 (심각!)

| 항목 | 내용 |
|------|------|
| **위치** | `web-viewer/open.html:201-204` vs `main/index.js:52-93` |
| **GPT 주장** | 웹뷰어에서 생성한 URL을 데스크톱 앱이 인식 못함 |
| **검증 결과** | ✅ **완전 유효** |
| **심각도** | 🔴 **심각** - "앱으로 열기" 기능이 완전히 작동 안 함 |

**일반인 설명:**
> 웹 뷰어에서 "앱으로 열기" 버튼을 누르면 `baeframe://open?video=...` 형식의 링크가 생성됩니다.
> 하지만 데스크톱 앱은 `baeframe://C:\경로\파일.mp4` 형식만 이해합니다.
> **결과:** 버튼을 눌러도 앱이 안 열리거나, 열려도 파일을 못 찾습니다.

**코드 증거:**
```javascript
// web-viewer/open.html:202-203 - 이렇게 생성하지만
`baeframe://open?video=${videoUrl}&bframe=${bframeUrl}`

// main/index.js:66 - 앱은 이렇게 처리 (query string 미지원!)
let filePath = url.replace(/^baeframe:\/\//, '');
// "open?video=..." 부분을 파일 경로로 해석 → 실패
```

---

### 1.2 🟠 copyFile/deleteFile API 누락 (높음)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/review-data-manager.js:307, 358` |
| **GPT 주장** | preload에 해당 API가 없어서 fallback 동작 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟠 **높음** - 런타임 에러 발생 가능 |

**일반인 설명:**
> 백업 파일을 복사하거나 삭제하려고 할 때 `electronAPI.copyFile is not a function` 에러가 발생합니다.
> fallback 로직이 있지만, 에러 로그가 계속 쌓이고 예상치 못한 동작이 발생할 수 있습니다.

**코드 증거:**
```javascript
// review-data-manager.js에서 호출
await window.electronAPI.copyFile(...)  // 호출하지만

// preload.js - copyFile, deleteFile 함수 정의 없음!
// → TypeError: window.electronAPI.copyFile is not a function
```

---

### 1.3 🟠 video.play() Promise 미처리 (높음)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/video-player.js:306` |
| **GPT 주장** | play() 실패 시 처리가 없음 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟠 **높음** - 사용자에게 피드백 없이 재생 실패 |

**일반인 설명:**
> 영상 재생 버튼을 눌렀을 때, 만약 재생이 실패하면(코덱 문제, 브라우저 정책 등) **아무런 안내가 없습니다**.
> 사용자는 "버튼이 고장났나?" 생각하고 여러 번 클릭하게 됩니다.

---

### 1.4 🟡 캔버스 크기 동기화 시 예외 가능성 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/drawing-canvas.js:86-99` |
| **GPT 주장** | 캔버스가 0x0일 때 `getImageData(0,0,0,0)` 예외 발생 가능 |
| **검증 결과** | ⚠️ **부분 유효** |
| **심각도** | 🟡 **중간** - 초기화 시점에 문제 가능 |

**일반인 설명:**
> 앱 시작 직후, 그림판 캔버스가 아직 크기가 정해지기 전에 그림을 복사하려고 하면 오류가 날 수 있습니다.
> 현대 브라우저에서는 대부분 안전하지만, 방어 코드가 없어서 예외 상황에 취약합니다.

---

### 1.5 🟡 Windows 파일 경로 URL 변환 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/video-player.js:266-270` |
| **GPT 주장** | `file://${filePath}` 방식이 공백/특수문자에서 실패 |
| **검증 결과** | ⚠️ **부분 유효** |
| **심각도** | 🟡 **중간** - 특수 경로에서만 문제 |

**일반인 설명:**
> `C:\내 문서\영상 파일 (최종).mp4` 같이 한글, 공백, 괄호가 있는 경로에서 영상이 안 열릴 수 있습니다.
> Electron 환경에서 대부분 작동하지만, `pathToFileURL()` 사용이 더 안전합니다.

---

### 1.6 🟡 wheel 이벤트 passive 옵션 누락 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/timeline.js:133` |
| **GPT 주장** | preventDefault()가 무시될 수 있음 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟡 **중간** - 타임라인 줌이 때때로 안 먹힘 |

**일반인 설명:**
> 타임라인에서 마우스 휠로 확대/축소할 때, 브라우저가 기본 스크롤을 먼저 처리해버려서 줌 기능이 제대로 안 될 수 있습니다.

---

### 1.7 🟢 앱 종료 시 강제 process.exit (낮음)

| 항목 | 내용 |
|------|------|
| **위치** | `main/index.js:289-295` |
| **GPT 주장** | 남아있는 저장 작업이 잘릴 수 있음 |
| **검증 결과** | ⚠️ **부분 유효** |
| **심각도** | 🟢 **낮음** - 500ms 타임아웃이 대부분 충분 |

**일반인 설명:**
> 앱 종료 시 500ms 후 강제 종료됩니다. 대부분 문제없지만, 아주 큰 파일 저장 중이면 데이터 손실 가능성이 있습니다.

---

## 2. 성능 & 최적화

### 2.1 🔴 Timeline.destroy() 리스너 누적 (심각!)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/timeline.js:2111-2118` |
| **GPT 주장** | destroy()가 이벤트 리스너를 정리하지 않음 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🔴 **심각** - 장시간 사용 시 앱 느려짐 |

**일반인 설명:**
> 타임라인을 만들 때 여러 개의 "감시자"(이벤트 리스너)를 등록합니다.
> 그런데 타임라인을 정리할 때 이 감시자들을 해제하지 않습니다.
> **결과:** 앱을 오래 사용하면 감시자가 수십 개씩 쌓여서 앱이 점점 느려집니다.

**누적되는 리스너 목록:**
```javascript
// _setupEventListeners()에서 추가 - 제거 안 됨
document.addEventListener('mousemove', ...)  // 플레이헤드 드래그
document.addEventListener('mouseup', ...)    // 드래그 종료

// _setupResizeObserver()에서 생성 - disconnect 안 됨
new ResizeObserver(...)

// 레이어/마커 추가 시 - 제거 안 됨
header.addEventListener('click', ...)
marker.addEventListener('click', ...)
```

---

### 2.2 🔴 DrawingCanvas.destroy() 리스너 누적 (심각!)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/drawing-canvas.js:70-81, 601-604` |
| **GPT 주장** | 7개 이벤트 리스너 정리 안 됨 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🔴 **심각** - 메모리 누수 |

**일반인 설명:**
> 그림판 캔버스에 7개의 감시자(마우스/터치 이벤트)가 등록되지만, 정리할 때 해제하지 않습니다.

**누적되는 리스너:**
```javascript
// _setupEventListeners() - 7개 등록, removeEventListener 없음
mousedown, mousemove, mouseup, mouseleave  // 4개
touchstart, touchmove, touchend            // 3개
```

---

### 2.3 🟠 썸네일 전체 로드 시 메모리 스파이크 (높음)

| 항목 | 내용 |
|------|------|
| **위치** | `main/ipc-handlers.js:493-531` |
| **GPT 주장** | 긴 영상에서 모든 썸네일을 한 번에 base64로 전송 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟠 **높음** - 10분+ 영상에서 문제 |

**일반인 설명:**
> 10분짜리 영상의 썸네일 수백 개를 한꺼번에 메모리에 올립니다.
> 영상이 길면 앱이 잠깐 멈추거나 메모리 부족 경고가 뜰 수 있습니다.

---

### 2.4 🟠 어니언 스킨 임시 캔버스 매번 생성 (높음)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/modules/drawing-manager.js:923-926` |
| **GPT 주장** | 매 프레임마다 새 캔버스 생성으로 GC 압박 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟠 **높음** - 애니메이션 재생 시 프레임 드랍 |

**일반인 설명:**
> 어니언 스킨(이전/다음 프레임 미리보기) 기능을 사용할 때마다 새 종이(캔버스)를 만들고 버립니다.
> 재활용하면 되는데 매번 새로 만들어서 쓰레기가 많이 쌓입니다.

**코드 증거:**
```javascript
// _renderOnionFrame() 내부 - 매번 새로 생성
const tempCanvas = document.createElement('canvas');
tempCanvas.width = this.onionSkinCanvasElement.width;
tempCanvas.height = this.onionSkinCanvasElement.height;
// → 재사용하지 않고 매 호출마다 생성
```

---

### 2.5 🟡 캐시 재귀 계산 시 UI 멈춤 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `main/ipc-handlers.js:623-654` |
| **GPT 주장** | 캐시 디렉토리 전체를 재귀적으로 계산 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟡 **중간** - 캐시가 크면 잠깐 멈춤 |

**일반인 설명:**
> 설정에서 "캐시 용량 확인"을 누르면 모든 파일을 하나씩 세어봅니다.
> 캐시에 파일이 많으면 1-2초 정도 앱이 멈춘 것처럼 보일 수 있습니다.

---

### 2.6 🟡 toDataURL 기반 썸네일 생성 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `thumbnail-generator.js` |
| **GPT 주장** | CPU/메모리 비용이 큼 |
| **검증 결과** | ⚠️ **부분 유효** |
| **심각도** | 🟡 **중간** - quick/full 분리로 완화됨 |

**일반인 설명:**
> 썸네일을 만들 때 CPU를 많이 사용하는 방식을 씁니다.
> 다행히 "빠른 생성 → 상세 생성" 2단계로 나눠서 사용성은 괜찮습니다.

---

### 2.7 🟡 이미지 로드 순차 처리 (중간-낮음)

| 항목 | 내용 |
|------|------|
| **위치** | `drawing-manager.js:624-644` |
| **GPT 주장** | 레이어가 많으면 렌더 지연 |
| **검증 결과** | ❌ **대부분 무효** |
| **심각도** | 🟡 **낮음** - 캐싱으로 완화됨 |

**실제 상황:**
> `_loadImage()` 함수에 캐싱이 구현되어 있어서 실제 지연은 최소화됩니다.
> 첫 로드 시에만 순차 로드가 발생하고, 이후에는 캐시에서 즉시 반환됩니다.

---

## 3. 코드 품질

### 3.1 🟠 validators.js 미사용 (높음)

| 항목 | 내용 |
|------|------|
| **위치** | `shared/validators.js` 존재, `review-data-manager.js`에서 미호출 |
| **GPT 주장** | 데이터 로드 시 검증이 이루어지지 않음 |
| **검증 결과** | ⚠️ **부분 유효** |
| **심각도** | 🟠 **높음** - 손상된 파일 로드 시 앱 오작동 |

**일반인 설명:**
> 파일을 열 때 내용이 올바른지 확인하는 검사기가 이미 만들어져 있지만, **실제로 사용하지 않고 있습니다**.
> 손상되거나 형식이 다른 .bframe 파일을 열면 앱이 이상하게 동작할 수 있습니다.

---

### 3.2 🟡 app.js 5352줄 - 거대한 단일 파일 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/app.js` |
| **GPT 주장** | 유지보수 비용이 한계 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟡 **중간** - 당장은 괜찮지만 장기적으로 문제 |

**일반인 설명:**
> 주 기능 파일이 **5,352줄**입니다. 일반 책으로 치면 약 150페이지 분량입니다.
> 한 파일에 모든 내용이 있어서 버그 찾기도, 수정하기도 어렵습니다.

---

### 3.3 🟡 하드코딩된 웹뷰어 URL (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `main/ipc-handlers.js:349, 379` |
| **GPT 주장** | URL이 코드에 직접 박혀있음 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟡 **중간** |

**코드 증거:**
```javascript
const webShareUrl = `https://baeframe.vercel.app/open.html?...`
// 주소가 바뀌면 코드를 직접 수정해야 함
```

---

### 3.4 🟢 유틸 함수 중복 (낮음)

| 항목 | 내용 |
|------|------|
| **위치** | `renderer/scripts/app.js` vs `web-viewer/scripts/app.js` |
| **GPT 주장** | escapeHtml 등 함수가 중복 존재 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟢 **낮음** |

---

### 3.5 🟢 데이터 모델 불일치 (무효)

| 항목 | 내용 |
|------|------|
| **위치** | `shared/schema.js` |
| **GPT 주장** | 스키마 vs 실제 필드 불일치 |
| **검증 결과** | ❌ **무효** |
| **심각도** | - |

**실제 상황:**
> 스키마가 잘 정의되어 있고, 마이그레이션 함수도 있습니다.
> GPT가 오래된 정보를 기반으로 판단한 것으로 보입니다.

---

## 4. Electron 보안

### 4.1 🟠 web-viewer XSS 취약점 (높음)

| 항목 | 내용 |
|------|------|
| **위치** | `web-viewer/scripts/app.js:1816, 1824` |
| **GPT 주장** | innerHTML 사용으로 XSS 취약 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟠 **높음** - 외부 공유 시 보안 문제 |

**일반인 설명:**
> 웹 뷰어에서 댓글 작성자 이름(`author`)을 표시할 때 **악성 코드가 실행될 수 있습니다**.
> 누군가 작성자 이름에 `<script>악성코드</script>`를 넣으면 다른 사람이 볼 때 실행됩니다.

**코드 증거:**
```javascript
// text는 이스케이프됨 ✅
<div class="comment-text">${escapeHtml(comment.text)}</div>

// author는 이스케이프 안 됨 ❌
<div class="comment-author">${comment.author || '익명'}</div>
<div class="reply-author">${reply.author || '익명'}</div>
```

---

### 4.2 🟡 sandbox: false 설정 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `main/window.js:49` |
| **GPT 주장** | 가능하면 true 권장 |
| **검증 결과** | ⚠️ **부분 유효** |
| **심각도** | 🟡 **중간** - 내부 도구라 리스크 낮음 |

**일반인 설명:**
> 웹 페이지가 컴퓨터의 민감한 부분에 접근하지 못하도록 "모래상자"에서 실행하는 게 안전합니다.
> 현재는 이 보호막이 꺼져있습니다. 내부 팀 도구이므로 당장 문제는 없습니다.

---

### 4.3 🟡 IPC 경로 검증 부재 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | `main/ipc-handlers.js` 전반 |
| **GPT 주장** | 파일 경로 검증 없이 사용 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟡 **중간** - 내부 도구라 리스크 낮음 |

**일반인 설명:**
> 파일 경로를 받아서 처리할 때, 그 경로가 안전한지 확인하지 않습니다.
> 이론적으로 `../../../중요파일` 같은 경로로 접근 시도가 가능합니다.

---

### 4.4 🟢 contextIsolation/nodeIntegration 설정 (양호)

| 항목 | 내용 |
|------|------|
| **위치** | `main/window.js:47-48` |
| **GPT 주장** | 기본값 올바르게 설정됨 |
| **검증 결과** | ✅ **확인됨 - 양호** |

**코드 증거:**
```javascript
webPreferences: {
  contextIsolation: true,   // 올바름 ✅
  nodeIntegration: false,   // 올바름 ✅
}
```

---

## 5. 아키텍처

### 5.1 🟡 싱글톤 패턴 남발 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | 여러 모듈 |
| **GPT 주장** | 테스트/다중 프로젝트 확장 시 문제 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟡 **중간** - 단일 윈도우 앱에서는 괜찮음 |

---

### 5.2 🟡 이벤트 기반 통신 추적 어려움 (중간)

| 항목 | 내용 |
|------|------|
| **위치** | EventTarget 기반 모듈들 |
| **GPT 주장** | 이벤트가 늘면 "스파게티"가 됨 |
| **검증 결과** | ⚠️ **부분 유효** |
| **심각도** | 🟡 **중간** |

---

### 5.3 🟢 shared 폴더 활용 부족 (낮음)

| 항목 | 내용 |
|------|------|
| **위치** | `shared/` 폴더 |
| **GPT 주장** | 공유 레이어로 더 활용 가능 |
| **검증 결과** | ✅ **유효** |
| **심각도** | 🟢 **낮음** |

---

## 두 Claude 세션 비교 결과

| 항목 | 다른 세션 | 이 세션 | 최종 판단 |
|------|----------|---------|----------|
| Timeline 리스너 | 🔴 매우 높음 (25개) | 🟡 중간 | **다른 세션 정확** - 실제로 많은 리스너 누적 |
| DrawingCanvas 리스너 | 🔴 높음 (7개) | 🟡 중간 | **다른 세션 정확** - 정확히 7개 |
| copyFile/deleteFile | 🔴 높음 | 🟢 낮음 | **다른 세션 정확** - 런타임 에러 발생 |
| 이미지 순차 로드 | ❌ 무효 (캐싱됨) | ✅ 유효 | **다른 세션 정확** - 캐싱 구현됨 |
| 데이터 모델 | ❌ 무효 | 언급 안 함 | **다른 세션 정확** - 스키마 일치 |
| XSS 취약점 | author 미이스케이프 | 부분 유효 | **다른 세션 정확** - author 필드 문제 |

---

## 우선순위별 수정 권장사항

### 🔴 즉시 수정 필요 (빌드 전 수정 강력 권장)

| # | 항목 | 영향 | 예상 작업량 |
|---|------|------|------------|
| 1 | **baeframe:// 프로토콜 파싱** | 웹→앱 열기 기능 완전 불가 | 1-2시간 |
| 2 | **Timeline.destroy() 리스너 정리** | 장시간 사용 시 앱 느려짐 | 2-3시간 |
| 3 | **DrawingCanvas.destroy() 리스너 정리** | 메모리 누수 | 1시간 |

### 🟠 조속한 수정 권장

| # | 항목 | 영향 | 예상 작업량 |
|---|------|------|------------|
| 4 | copyFile/deleteFile API 추가 | 런타임 에러 | 30분 |
| 5 | video.play() 에러 처리 | UX 저하 | 30분 |
| 6 | 썸네일 로드 최적화 | 긴 영상 성능 | 2-4시간 |
| 7 | 어니언 스킨 캔버스 재사용 | 애니메이션 성능 | 1-2시간 |
| 8 | web-viewer XSS (author 이스케이프) | 보안 | 10분 |
| 9 | validators.js 실제 사용 | 데이터 무결성 | 1시간 |

### 🟡 개선 권장 (장기)

| # | 항목 | 영향 |
|---|------|------|
| 10 | app.js 분리 | 유지보수성 |
| 11 | IPC 경로 검증 | 보안 강화 |
| 12 | 하드코딩 URL 환경변수화 | 배포 유연성 |
| 13 | wheel passive 옵션 | 타임라인 줌 안정성 |
| 14 | sandbox: true 전환 검토 | 보안 강화 |

---

## GPT 리뷰 + 두 Claude 세션 통합 평가

| 평가 항목 | GPT | 다른 Claude | 이 세션 |
|----------|-----|-------------|---------|
| 정확도 | 8/10 | 9/10 | 8/10 |
| 심각도 판단 | 7/10 (과장) | 8/10 | 7/10 (과소) |
| 구체성 | 9/10 | 10/10 | 8/10 |

**결론:**
- GPT 리뷰는 전반적으로 정확하지만 일부 심각도가 과장됨
- 다른 Claude 세션이 가장 정확한 분석을 제공함 (구체적인 리스너 개수 등)
- 이 세션은 심각도를 과소평가한 부분이 있음 (특히 리스너 누적 문제)

---

## 최종 권장사항

**빌드 전 최소 수정사항:**
1. ✅ baeframe:// 프로토콜 파싱 수정
2. ✅ web-viewer XSS (author 이스케이프) - 10분 작업

**빌드 후 조기 수정:**
3. Timeline/DrawingCanvas 이벤트 리스너 정리
4. copyFile/deleteFile API 추가

---

## 잘된 점 (GPT + Claude 공통 인정)

- ✅ contextIsolation/nodeIntegration 설정 올바름
- ✅ 모듈별 관심사 분리 (EventTarget 기반)
- ✅ 마이그레이션 루틴 존재 (shared/schema.js)
- ✅ uncaughtException/unhandledRejection 로깅
- ✅ 썸네일 quick/full 단계 분리 + abort 지원
- ✅ 이미지 로드 캐싱 구현

---

## GitHub 이슈 #70: 파일 열기 오류

### 문제 상황

| 항목 | 내용 |
|------|------|
| **이슈** | [#70 파일열기 오류](https://github.com/baehandoridori/BAEFRAME/issues/70) |
| **상태** | Open |
| **심각도** | 🔴 **심각** |

### 문제 설명

1. 사용자가 영상 파일을 열고 링크 공유를 누름
2. **수정 사항이 없는 경우** `.bframe` 파일이 아직 생성되지 않음
3. 공유된 링크에 `.bframe` 경로가 포함되어 있음
4. 다른 사용자가 링크를 열면 → `.bframe` 파일이 없으므로 실패

### 일반인 설명

> 새 영상 파일을 열고 바로 "공유 링크"를 누르면, 아직 저장을 안 했기 때문에
> **리뷰 데이터 파일(.bframe)이 없습니다**.
> 그런데 공유 링크에는 이 파일 경로가 포함되어 있어서,
> 다른 사람이 링크를 열면 "파일을 찾을 수 없습니다" 오류가 발생합니다.

### 코드 분석

**현재 링크 생성 로직** (`main/ipc-handlers.js`):
```javascript
// 영상 경로로 .bframe 경로 생성
const bframePath = videoPath.replace(/\.[^.]+$/, '.bframe');
const webShareUrl = `https://baeframe.vercel.app/open.html?video=...&bframe=...`;
// 문제: .bframe 파일이 존재하는지 확인하지 않음!
```

### 해결 방안

#### 방안 1: 자동 저장 (권장)

**개념:** 링크 공유 시점에 `.bframe` 파일이 없으면 자동으로 생성

```javascript
// ipc-handlers.js 수정
ipcMain.handle('share-link', async (event, videoPath) => {
  const bframePath = videoPath.replace(/\.[^.]+$/, '.bframe');

  // 파일 존재 확인
  if (!fs.existsSync(bframePath)) {
    // 빈 .bframe 파일 자동 생성
    const emptyBframe = {
      version: '1.1.0',
      comments: [],
      layers: [],
      videoPath: videoPath
    };
    fs.writeFileSync(bframePath, JSON.stringify(emptyBframe, null, 2));
    log.info('공유를 위해 .bframe 파일 자동 생성:', bframePath);
  }

  // 링크 생성 계속...
});
```

**장점:**
- 사용자 경험 최적 (추가 동작 불필요)
- 빈 파일이라도 앱에서 열 수 있음

**단점:**
- 의도치 않은 파일 생성

#### 방안 2: 경고 후 선택

**개념:** `.bframe` 파일이 없으면 경고하고 저장 여부 확인

```javascript
if (!fs.existsSync(bframePath)) {
  // 렌더러에 알림 전송
  event.sender.send('bframe-not-found', {
    message: '리뷰 데이터가 아직 저장되지 않았습니다.',
    options: ['저장 후 공유', '영상만 공유', '취소']
  });
  return;
}
```

**장점:**
- 사용자가 명시적으로 결정

**단점:**
- 추가 클릭 필요

#### 방안 3: 영상만 공유 옵션

**개념:** `.bframe` 파일 없이 영상만 공유하는 링크 생성

```javascript
// bframe 파라미터 없이 링크 생성
const webShareUrl = `https://baeframe.vercel.app/open.html?video=${encodeURIComponent(videoUrl)}`;
// 웹 뷰어에서 영상만 표시, 댓글/그리기 없음
```

### 권장 해결책

**방안 1 + 방안 3 조합:**

1. `.bframe` 파일이 없으면 빈 파일 자동 생성
2. 웹 뷰어에서도 `bframe` 파라미터 없이 영상만 열 수 있도록 수정
3. 데스크톱 앱에서도 영상만 열 수 있도록 수정

### 연관 이슈

이 문제는 **1.1 baeframe:// 프로토콜 미스매치**와 연관됩니다:

| 이슈 | 문제 | 수정 위치 |
|------|------|----------|
| #70 | .bframe 파일 미존재 | `main/ipc-handlers.js` |
| 1.1 | 프로토콜 파싱 불일치 | `main/index.js`, `web-viewer/open.html` |

**두 이슈를 함께 수정하면:**
- 웹→앱 열기 완전 정상화
- 파일 없이도 공유 가능

---

## 수정 작업 순서

다음 순서로 진행 권장:

### Phase 1: 핵심 버그 수정 (필수)

| # | 작업 | 파일 | 예상 시간 |
|---|------|------|----------|
| 1 | baeframe:// 프로토콜 파싱 수정 | `main/index.js` | 1시간 |
| 2 | #70 .bframe 자동 생성 | `main/ipc-handlers.js` | 30분 |
| 3 | web-viewer XSS 수정 | `web-viewer/scripts/app.js` | 10분 |

### Phase 2: 메모리 누수 수정 (권장)

| # | 작업 | 파일 | 예상 시간 |
|---|------|------|----------|
| 4 | Timeline.destroy() 리스너 정리 | `renderer/scripts/modules/timeline.js` | 2시간 |
| 5 | DrawingCanvas.destroy() 리스너 정리 | `renderer/scripts/modules/drawing-canvas.js` | 1시간 |
| 6 | copyFile/deleteFile API 추가 | `preload/preload.js`, `main/ipc-handlers.js` | 30분 |

### Phase 3: 성능/품질 개선 (선택)

| # | 작업 | 파일 | 예상 시간 |
|---|------|------|----------|
| 7 | video.play() 에러 처리 | `renderer/scripts/modules/video-player.js` | 30분 |
| 8 | validators.js 실제 사용 | `renderer/scripts/modules/review-data-manager.js` | 1시간 |
| 9 | wheel passive 옵션 | `renderer/scripts/modules/timeline.js` | 15분 |

---

## GitHub 이슈 #72: 추가 기능 고안

> 등록일: 2026-01-14
> 상태: Open
> 링크: [#72](https://github.com/baehandoridori/BAEFRAME/issues/72)

### 요청 내용

#### 1. 영상 렌더링 기능 (메시지/드로잉 포함)

| 항목 | 상세 |
|------|------|
| **기본 기능** | 메시지와 드로잉이 포함된 영상 렌더링 |
| **해상도** | FHD 또는 저해상도 선택 가능 |
| **저장 위치** | .bframe 파일과 동일 경로에 자동 생성 |
| **토글 옵션** | 메시지 표기 여부, 드로잉 표기 여부 |
| **기본값** | 드로잉+메시지 표기, 메시지 펼쳐진 상태 |

**구현 계획:**

```
1. ffmpeg를 사용한 영상 렌더링
   - 각 프레임에 그리기 레이어 합성
   - 댓글 오버레이 추가

2. 렌더링 옵션 UI
   - 해상도 선택 (1080p, 720p, 480p)
   - 메시지 표시 토글
   - 드로잉 표시 토글
   - 출력 경로 선택 (기본: .bframe 동일 경로)

3. 진행률 표시
   - 프로그레스 바
   - 취소 기능
```

#### 2. 마커 위치 이동 기능

| 항목 | 상세 |
|------|------|
| **요청** | 댓글 마커(원형 이미지) 드래그로 위치 이동 |
| **현재** | 마커 위치 고정 |

**구현 계획:**

```
1. 마커 요소에 드래그 이벤트 추가
2. 드래그 중 위치 업데이트
3. 드래그 종료 시 좌표 저장 (.bframe 파일)
4. 댓글 데이터 구조에 position 필드 추가
```

#### 3. 하이라이트 구간 이동 단축키

| 항목 | 상세 |
|------|------|
| **요청** | 다음/이전 하이라이트 구간으로 이동 |
| **제안 단축키** | `[` / `]` 또는 `Shift+← / →` |

**구현 계획:**

```
1. 하이라이트 구간 목록 정렬
2. 현재 프레임에서 가장 가까운 다음/이전 구간 찾기
3. 해당 구간 시작점으로 이동
4. 단축키 바인딩 추가
```

#### 4. 댓글 구간 이동 기능

| 항목 | 상세 |
|------|------|
| **요청** | 다음/이전 댓글로 이동 |
| **제안 단축키** | `N` / `P` 또는 `Ctrl+← / →` |

**구현 계획:**

```
1. 댓글 목록을 프레임 순으로 정렬
2. 현재 프레임에서 가장 가까운 다음/이전 댓글 찾기
3. 해당 댓글 프레임으로 이동
4. 단축키 바인딩 추가
```

### 우선순위 제안

| 순위 | 기능 | 예상 작업량 | 난이도 |
|:----:|------|------------|:------:|
| 1 | 댓글 구간 이동 | 2-3시간 | 🟢 낮음 |
| 2 | 하이라이트 구간 이동 | 2-3시간 | 🟢 낮음 |
| 3 | 마커 위치 이동 | 4-6시간 | 🟡 중간 |
| 4 | 영상 렌더링 | 1-2일 | 🔴 높음 |

### 연관 작업

- Phase 8 코덱 지원 확장 (ffmpeg 번들링)과 연계 가능
- 영상 렌더링은 ffmpeg가 준비된 후 진행 권장

---

## 구현 완료 (2026-01-14)

### #70 링크 공유 시 .bframe 자동 생성

| 항목 | 내용 |
|------|------|
| **문제** | 링크 복사 시 .bframe 파일이 저장되지 않으면 공유 불가 |
| **해결** | 링크 복사 전 파일 존재 여부 확인 후 자동 저장 |
| **수정 파일** | `app.js`, `preload.js`, `ipc-handlers.js` |

### #72 댓글/하이라이트 구간 이동

| 기능 | UI | 단축키 | 수정 파일 |
|------|-----|--------|----------|
| 이전 댓글 | ← 버튼 | `Shift+←` | `index.html`, `app.js`, `comment-manager.js` |
| 다음 댓글 | → 버튼 | `Shift+→` | `index.html`, `app.js`, `comment-manager.js` |
| 이전 하이라이트 | ← 버튼 | `Alt+←` | `index.html`, `app.js`, `highlight-manager.js` |
| 다음 하이라이트 | → 버튼 | `Alt+→` | `index.html`, `app.js`, `highlight-manager.js` |

**추가 기능:**
- 구간 이동 시 타임라인 자동 스크롤 (`timeline.scrollToPlayhead()`)
- 구간이 없으면 토스트 알림 표시

### 댓글 클릭 버그 수정

| 항목 | 내용 |
|------|------|
| **문제** | 댓글 구간이 지나도 마커 클릭 가능 |
| **원인** | CSS `pointer-events: none` 적용 전 클릭 이벤트 처리 |
| **해결** | 클릭 핸들러에서 `isVisibleAtFrame()` 체크 추가 |
| **수정 파일** | `app.js:3471-3481` |
