<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BAEFRAME - íŒŒì¼ ì—´ê¸°</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: #fff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }

    .container {
      text-align: center;
      max-width: 400px;
    }

    .logo {
      font-size: 3rem;
      font-weight: bold;
      background: linear-gradient(135deg, #4a9eff, #ff4a9e);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: #888;
      margin-bottom: 2rem;
    }

    .loader {
      width: 50px;
      height: 50px;
      border: 3px solid #333;
      border-top-color: #4a9eff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1.5rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .status {
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }

    .status-detail {
      color: #888;
      font-size: 0.9rem;
      margin-bottom: 2rem;
    }

    .buttons {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .btn {
      padding: 1rem 2rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      transition: transform 0.2s, opacity 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: linear-gradient(135deg, #4a9eff, #4aff9e);
      color: #000;
      font-weight: bold;
    }

    .btn-secondary {
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #444;
    }

    .hidden {
      display: none !important;
    }

    .platform-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: rgba(74, 158, 255, 0.2);
      border: 1px solid rgba(74, 158, 255, 0.5);
      border-radius: 20px;
      font-size: 0.8rem;
      color: #4a9eff;
      margin-bottom: 1rem;
    }

    .error-message {
      background: rgba(255, 74, 74, 0.2);
      border: 1px solid rgba(255, 74, 74, 0.5);
      padding: 1rem;
      border-radius: 8px;
      color: #ff6b6b;
      margin-bottom: 1.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">BAEFRAME</div>
    <div class="subtitle">ì˜ìƒ ë¦¬ë·° í˜‘ì—… ë„êµ¬</div>

    <div id="platformBadge" class="platform-badge"></div>

    <div id="loadingState">
      <div class="loader"></div>
      <div class="status" id="statusText">íŒŒì¼ ì •ë³´ í™•ì¸ ì¤‘...</div>
      <div class="status-detail" id="statusDetail"></div>
    </div>

    <div id="errorState" class="hidden">
      <div class="error-message" id="errorMessage"></div>
    </div>

    <div id="buttons" class="buttons hidden">
      <a href="#" id="btnOpenApp" class="btn btn-secondary">
        ğŸ–¥ï¸ ë°ìŠ¤í¬í†± ì•±ìœ¼ë¡œ ì—´ê¸°
      </a>
      <a href="#" id="btnOpenWeb" class="btn btn-primary">
        ğŸŒ ì›¹ ë·°ì–´ë¡œ ì—´ê¸°
      </a>
    </div>
  </div>

  <script>
    // URL íŒŒë¼ë¯¸í„° íŒŒì‹±
    const params = new URLSearchParams(window.location.search);
    const videoUrl = params.get('video');
    const bframeUrl = params.get('bframe');

    // í”Œë«í¼ ê°ì§€
    const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const isAndroid = /Android/i.test(navigator.userAgent);
    const isMac = /Mac/i.test(navigator.userAgent) && !isMobile;
    const isWindows = /Win/i.test(navigator.userAgent);

    // UI ìš”ì†Œ
    const platformBadge = document.getElementById('platformBadge');
    const loadingState = document.getElementById('loadingState');
    const errorState = document.getElementById('errorState');
    const errorMessage = document.getElementById('errorMessage');
    const buttons = document.getElementById('buttons');
    const btnOpenApp = document.getElementById('btnOpenApp');
    const btnOpenWeb = document.getElementById('btnOpenWeb');
    const statusText = document.getElementById('statusText');
    const statusDetail = document.getElementById('statusDetail');

    // í”Œë«í¼ í‘œì‹œ
    if (isMobile) {
      platformBadge.textContent = isIOS ? 'ğŸ“± iOS' : 'ğŸ“± Android';
    } else if (isMac) {
      platformBadge.textContent = 'ğŸ macOS';
    } else if (isWindows) {
      platformBadge.textContent = 'ğŸªŸ Windows';
    } else {
      platformBadge.textContent = 'ğŸ’» Desktop';
    }

    // URL ìœ íš¨ì„± ê²€ì‚¬
    function validateUrls() {
      if (!videoUrl || !bframeUrl) {
        showError('íŒŒì¼ URLì´ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ê³µìœ  ë§í¬ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.');
        return false;
      }
      return true;
    }

    // ì—ëŸ¬ í‘œì‹œ
    function showError(message) {
      loadingState.classList.add('hidden');
      errorState.classList.remove('hidden');
      errorMessage.textContent = message;
      buttons.classList.remove('hidden');
      updateButtons();
    }

    // ë²„íŠ¼ URL ì„¤ì •
    function updateButtons() {
      // ì›¹ ë·°ì–´ URL
      const webViewerUrl = `./index.html?video=${encodeURIComponent(videoUrl)}&bframe=${encodeURIComponent(bframeUrl)}`;
      btnOpenWeb.href = webViewerUrl;

      // ë°ìŠ¤í¬í†± ì•± URL (baeframe:// í”„ë¡œí† ì½œ)
      const appUrl = `baeframe://open?video=${encodeURIComponent(videoUrl)}&bframe=${encodeURIComponent(bframeUrl)}`;
      btnOpenApp.href = appUrl;

      // ëª¨ë°”ì¼ì—ì„œëŠ” ì•± ë²„íŠ¼ ìˆ¨ê¸°ê¸°
      if (isMobile) {
        btnOpenApp.classList.add('hidden');
      }
    }

    // ì•± ì—´ê¸° ì‹œë„
    function tryOpenApp() {
      const appUrl = `baeframe://open?video=${encodeURIComponent(videoUrl)}&bframe=${encodeURIComponent(bframeUrl)}`;

      statusText.textContent = 'ë°ìŠ¤í¬í†± ì•± ì—´ê¸° ì‹œë„ ì¤‘...';
      statusDetail.textContent = 'ì•±ì´ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ ìë™ìœ¼ë¡œ ì—´ë¦½ë‹ˆë‹¤';

      // ì•± ì—´ê¸° ì‹œë„
      const startTime = Date.now();
      window.location.href = appUrl;

      // 2ì´ˆ í›„ ì•±ì´ ì•ˆ ì—´ë ¸ìœ¼ë©´ ì›¹ìœ¼ë¡œ í´ë°±
      setTimeout(() => {
        // í˜ì´ì§€ê°€ ì•„ì§ ë³´ì´ë©´ ì•±ì´ ì•ˆ ì—´ë¦° ê²ƒ
        if (document.visibilityState !== 'hidden' && Date.now() - startTime < 3000) {
          statusText.textContent = 'ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤';
          statusDetail.textContent = 'ì›¹ ë·°ì–´ë¡œ ì´ë™í•©ë‹ˆë‹¤...';

          setTimeout(() => {
            redirectToWebViewer();
          }, 1000);
        }
      }, 2000);
    }

    // ì›¹ ë·°ì–´ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    function redirectToWebViewer() {
      const webViewerUrl = `./index.html?video=${encodeURIComponent(videoUrl)}&bframe=${encodeURIComponent(bframeUrl)}`;
      window.location.href = webViewerUrl;
    }

    // ë©”ì¸ ë¡œì§
    function main() {
      if (!validateUrls()) {
        return;
      }

      updateButtons();

      if (isMobile) {
        // ëª¨ë°”ì¼: ë°”ë¡œ ì›¹ ë·°ì–´ë¡œ ì´ë™
        statusText.textContent = 'ëª¨ë°”ì¼ í™˜ê²½ ê°ì§€';
        statusDetail.textContent = 'ì›¹ ë·°ì–´ë¡œ ì´ë™í•©ë‹ˆë‹¤...';

        setTimeout(() => {
          redirectToWebViewer();
        }, 1000);
      } else {
        // ë°ìŠ¤í¬í†±: ì•± ì—´ê¸° ì‹œë„ í›„ í´ë°±
        tryOpenApp();
      }
    }

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ìˆ˜ë™ ì„ íƒ ì‹œ)
    btnOpenApp.addEventListener('click', (e) => {
      // hrefë¡œ ìë™ ì´ë™í•˜ë¯€ë¡œ ë³„ë„ ì²˜ë¦¬ ë¶ˆí•„ìš”
    });

    btnOpenWeb.addEventListener('click', (e) => {
      // hrefë¡œ ìë™ ì´ë™
    });

    // ì‹œì‘
    main();
  </script>
</body>
</html>
