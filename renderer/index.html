<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob:;">
  <title>baeframe - Video Review Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <div class="logo">
        <div class="logo-icon">B</div>
        <span>baeframe</span>
      </div>
      <div class="file-info" id="fileInfo">
        <span class="file-icon">🎬</span>
        <span class="file-name" id="fileName">파일을 열어주세요</span>
        <span class="file-path" id="filePath"></span>
        <span class="version-badge" id="versionBadge" style="display: none;">v1</span>
      </div>
    </div>
    <div class="header-right">
      <button class="btn btn-secondary" id="btnOpenFolder" title="파일 경로 열기" style="display: none;">
        <span>📁</span>
        파일 경로 열기
      </button>
      <button class="btn btn-secondary" id="btnOpenOther" title="다른 파일 열기" style="display: none;">
        <span>📂</span>
        다른 파일 열기
      </button>
      <button class="btn btn-secondary" id="btnVersionHistory">
        <span>📋</span>
        버전 히스토리
      </button>
      <button class="btn btn-primary" id="btnCopyLink">
        <span>🔗</span>
        링크 복사
      </button>
      <button class="btn btn-secondary" id="btnWebShare" title="웹 공유 링크 생성">
        <span>🌐</span>
        웹 공유
      </button>
    </div>
  </header>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Viewer Section -->
    <div class="viewer-section" id="viewerSection">
      <!-- Video Viewer -->
      <div class="viewer-container" id="viewerContainer">
        <div class="video-wrapper" id="videoWrapper">
          <!-- 드롭 존 -->
          <div class="drop-zone" id="dropZone">
            <div class="drop-zone-content">
              <img class="drop-zone-logo" src="assets/logo/baeframe.png" alt="BAEFRAME" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
              <div class="drop-zone-icon" style="display: none;">🎬</div>
              <div class="drop-zone-text">영상 파일을 여기에 드롭하세요</div>
              <div class="drop-zone-hint">MOV, MP4, H.264/265 지원</div>
              <button class="btn btn-primary" id="btnOpenFile" style="margin-top: 16px;">
                <span>📂</span>
                파일 열기
              </button>
            </div>
          </div>

          <!-- Video Element (추후 mpv로 대체) -->
          <video id="videoPlayer" style="display: none;"></video>

          <!-- TODO: 영상 어니언 스킨 캔버스 - 비디오 가림 문제로 임시 비활성화
          <canvas id="videoOnionSkinCanvas"></canvas>
          -->

          <!-- Video Loading Overlay -->
          <div class="video-loading-overlay" id="videoLoadingOverlay">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">썸네일 생성 중...</div>
            <div class="loading-progress-bar">
              <div class="loading-progress-fill" id="loadingProgressFill"></div>
            </div>
          </div>

          <!-- Codec Unsupported Overlay -->
          <div class="codec-error-overlay" id="codecErrorOverlay">
            <div class="codec-error-icon">⚠️</div>
            <div class="codec-error-title">지원하지 않는 코덱</div>
            <div class="codec-error-message">이 영상은 지원하지 않는 코덱(MPEG-4 Part 2, HEVC 등)입니다.</div>
            <div class="codec-error-hint">H.264 코덱으로 변환 후 다시 열어주세요.</div>
            <button class="btn btn-secondary" id="btnCodecErrorClose">다른 파일 열기</button>
          </div>

          <!-- Onion Skin Canvas (그리기 캔버스 아래에 표시) -->
          <canvas id="onionSkinCanvas" class="drawing-overlay onion-skin-layer"></canvas>

          <!-- Drawing Overlay Canvas -->
          <canvas id="drawingCanvas" class="drawing-overlay"></canvas>

          <!-- Video Zoom Controls -->
          <div class="video-zoom-controls" id="videoZoomControls">
            <button class="video-zoom-btn" id="btnVideoZoomOut" title="축소">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
            </button>
            <span class="video-zoom-display" id="videoZoomDisplay">100%</span>
            <button class="video-zoom-btn" id="btnVideoZoomIn" title="확대">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
            </button>
            <button class="video-zoom-btn" id="btnVideoZoomReset" title="원본 크기 (100%)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
            </button>
          </div>

          <!-- Zoom Indicator Overlay -->
          <div class="zoom-indicator-overlay" id="zoomIndicatorOverlay"></div>

          <!-- Drawing Tools Palette (이동/접기 가능) -->
          <div class="drawing-tools" id="drawingTools">
            <!-- 드래그 핸들 및 접기 버튼 -->
            <div class="drawing-tools-header" id="drawingToolsHeader">
              <span class="drag-handle" title="드래그하여 이동">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><circle cx="9" cy="5" r="1.5"/><circle cx="15" cy="5" r="1.5"/><circle cx="9" cy="12" r="1.5"/><circle cx="15" cy="12" r="1.5"/><circle cx="9" cy="19" r="1.5"/><circle cx="15" cy="19" r="1.5"/></svg>
              </span>
              <span class="tools-title">그리기 도구</span>
              <button class="collapse-btn" id="collapseToolsBtn" title="접기/펴기">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
              </button>
            </div>

            <!-- 접히는 컨텐츠 영역 -->
            <div class="drawing-tools-content" id="drawingToolsContent">
              <!-- 도구 선택 -->
              <div class="tools-section">
                <div class="section-label">도구</div>
                <div class="tools-row">
                  <button class="tool-btn active" data-tool="pen" title="펜 (P)">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
                  </button>
                  <button class="tool-btn" data-tool="brush" title="브러쉬 (B)">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M9.06 11.9l8.07-8.06a2.85 2.85 0 1 1 4.03 4.03l-8.06 8.08"/><path d="M7.07 14.94c-1.66 0-3 1.35-3 3.02 0 1.33-2.5 1.52-2 2.02 1.08 1.1 2.49 2.02 4 2.02 2.2 0 4-1.8 4-4.04a3.01 3.01 0 0 0-3-3.02z"/></svg>
                  </button>
                  <button class="tool-btn" data-tool="eraser" title="지우개 (E)">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"/><path d="M22 21H7"/><path d="m5 11 9 9"/></svg>
                  </button>
                  <button class="tool-btn" data-tool="line" title="선 (L)">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="19" x2="19" y2="5"/></svg>
                  </button>
                  <button class="tool-btn" data-tool="arrow" title="화살표 (A)">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                  </button>
                  <button class="tool-btn" data-tool="rect" title="사각형 (R)">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>
                  </button>
                  <button class="tool-btn" data-tool="circle" title="원 (O)">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg>
                  </button>
                </div>
              </div>

              <!-- 브러쉬 사이즈 -->
              <div class="tools-section">
                <div class="section-label">크기 <span id="brushSizeValue">3px</span></div>
                <div class="size-slider-wrapper">
                  <input type="range" class="size-slider" id="brushSizeSlider" min="1" max="50" value="3">
                  <div class="size-preview" id="sizePreview"></div>
                </div>
              </div>

              <!-- 불투명도 (지우개 제외) -->
              <div class="tools-section" id="opacitySection">
                <div class="section-label">불투명도 <span id="brushOpacityValue">100%</span></div>
                <div class="size-slider-wrapper">
                  <input type="range" class="size-slider" id="brushOpacitySlider" min="10" max="100" value="100">
                </div>
              </div>

              <!-- 색상 선택 -->
              <div class="tools-section">
                <div class="section-label">색상</div>
                <div class="colors-row">
                  <button class="color-btn active" data-color="red" style="background: #ff4757" title="빨강"></button>
                  <button class="color-btn" data-color="yellow" style="background: #ffd000" title="노랑"></button>
                  <button class="color-btn" data-color="green" style="background: #26de81" title="초록"></button>
                  <button class="color-btn" data-color="blue" style="background: #4a9eff" title="파랑"></button>
                  <button class="color-btn" data-color="white" style="background: #ffffff; border: 1px solid #555" title="하양"></button>
                  <button class="color-btn" data-color="black" style="background: #000000" title="검정"></button>
                  <button class="color-btn" data-color="mint" style="background: #1abc9c" title="민트"></button>
                  <button class="color-btn" data-color="pink" style="background: #ff6b9d" title="핑크"></button>
                </div>
              </div>

              <!-- 그리기 어니언 스킨 -->
              <div class="tools-section">
                <div class="section-label">
                  그리기 어니언
                  <button class="onion-toggle" id="onionToggle" title="어니언 스킨 토글">OFF</button>
                </div>
                <div class="onion-controls" id="onionControls">
                  <div class="onion-row">
                    <span>이전</span>
                    <input type="number" id="onionBefore" min="0" max="5" value="2">
                    <span>장</span>
                  </div>
                  <div class="onion-row">
                    <span>이후</span>
                    <input type="number" id="onionAfter" min="0" max="5" value="1">
                    <span>장</span>
                  </div>
                  <div class="onion-row">
                    <span>투명도</span>
                    <input type="range" id="onionOpacity" min="10" max="80" value="30">
                    <span id="onionOpacityValue">30%</span>
                  </div>
                </div>
              </div>

              <!-- TODO: 영상 어니언 스킨 - 비디오 가림 문제로 임시 비활성화
              <div class="tools-section">
                <div class="section-label">
                  영상 어니언
                  <button class="onion-toggle" id="videoOnionToggle" title="영상 어니언 스킨 토글">OFF</button>
                </div>
                <div class="onion-controls" id="videoOnionControls">
                  <div class="onion-row">
                    <span>이전</span>
                    <input type="number" id="videoOnionBefore" min="0" max="5" value="1">
                    <span>장</span>
                  </div>
                  <div class="onion-row">
                    <span>이후</span>
                    <input type="number" id="videoOnionAfter" min="0" max="5" value="1">
                    <span>장</span>
                  </div>
                  <div class="onion-row">
                    <span>투명도</span>
                    <input type="range" id="videoOnionOpacity" min="10" max="60" value="30">
                    <span id="videoOnionOpacityValue">30%</span>
                  </div>
                </div>
              </div>
              -->

              <!-- 액션 버튼 -->
              <div class="tools-section tools-actions">
                <button class="tool-btn" id="btnUndo" title="실행 취소 (Ctrl+Z)">
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                </button>
                <button class="tool-btn" id="btnClearDrawing" title="전체 지우기">
                  <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Resizer (Horizontal) -->
      <div class="resizer resizer-h" id="viewerResizer"></div>

      <!-- Playback Controls -->
      <div class="controls-bar">
        <div class="playback-controls">
          <button class="control-btn" id="btnFirst" title="처음으로 (Home)">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polygon points="19 20 9 12 19 4 19 20"/><line x1="5" y1="19" x2="5" y2="5"/></svg>
          </button>
          <button class="control-btn" id="btnPrevFrame" title="이전 프레임 (←)">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polygon points="11 19 2 12 11 5 11 19"/><polygon points="22 19 13 12 22 5 22 19"/></svg>
          </button>
          <button class="control-btn play-btn" id="btnPlay" title="재생/일시정지 (Space)">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" id="playIcon"><polygon points="5 3 19 12 5 21 5 3"/></svg>
          </button>
          <button class="control-btn" id="btnNextFrame" title="다음 프레임 (→)">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 19 22 12 13 5 13 19"/><polygon points="2 19 11 12 2 5 2 19"/></svg>
          </button>
          <button class="control-btn" id="btnLast" title="끝으로 (End)">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 4 15 12 5 20 5 4"/><line x1="19" y1="5" x2="19" y2="19"/></svg>
          </button>
        </div>

        <div class="timecode" id="timecode">
          <span class="timecode-current" id="timecodeCurrent">00:00:00:00</span>
          <span class="timecode-separator">/</span>
          <span class="timecode-total" id="timecodeTotal">00:00:00:00</span>
        </div>

        <div class="frame-indicator" id="frameIndicator">24fps · Frame 0 / 0</div>

        <div class="controls-spacer"></div>

        <div class="action-controls">
          <button class="action-btn" id="btnDrawMode">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
            그리기
            <span class="shortcut-hint">D</span>
          </button>
          <button class="action-btn" id="btnAddComment">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            댓글 추가
            <span class="shortcut-hint">C</span>
          </button>
        </div>

        <!-- TODO: 영상 어니언 스킨 토글 - 비디오 가림 문제로 임시 비활성화
        <button class="control-toggle-btn" id="btnVideoOnionSkin" title="영상 어니언 스킨 (단축키 없음)">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" opacity="0.3"/>
            <circle cx="12" cy="12" r="7" opacity="0.5"/>
            <circle cx="12" cy="12" r="4"/>
          </svg>
        </button>
        -->

        <!-- 구간 반복 컨트롤 -->
        <div class="loop-controls" id="loopControls">
          <button class="loop-btn" id="btnSetInPoint" title="시작점 설정 (I)">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 19l-7-7 7-7"/><line x1="4" y1="12" x2="20" y2="12"/></svg>
            <span class="loop-timecode" id="inPointDisplay">--:--</span>
          </button>
          <button class="loop-btn loop-toggle" id="btnLoopToggle" title="구간 반복 (L)">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
          </button>
          <button class="loop-btn" id="btnSetOutPoint" title="종료점 설정 (O)">
            <span class="loop-timecode" id="outPointDisplay">--:--</span>
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 5l7 7-7 7"/><line x1="20" y1="12" x2="4" y2="12"/></svg>
          </button>
          <button class="loop-btn loop-clear" id="btnClearLoop" title="구간 초기화">
            <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
      </div>

      <!-- Timeline -->
      <div class="timeline-section" id="timelineSection">
        <div class="timeline-toolbar">
          <div class="timeline-toolbar-left">
            <div class="timeline-title">
              <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--accent-primary)"><rect x="2" y="7" width="20" height="10" rx="2"/><line x1="6" y1="7" x2="6" y2="17"/><line x1="10" y1="7" x2="10" y2="17"/><line x1="14" y1="7" x2="14" y2="17"/><line x1="18" y1="7" x2="18" y2="17"/></svg>
              타임라인
            </div>
          </div>
          <div class="timeline-toolbar-right">
            <div class="zoom-buttons">
              <button class="zoom-btn" id="btnTimelineZoomOut" title="축소">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </button>
              <button class="zoom-btn" id="btnTimelineZoomReset" title="원본 (100%)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
              </button>
              <button class="zoom-btn" id="btnTimelineZoomIn" title="확대">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </button>
            </div>
            <div class="zoom-control">
              <span class="zoom-label">줌</span>
              <input type="range" class="zoom-slider" id="zoomSlider" min="1" max="100" value="50">
              <span class="zoom-display" id="zoomDisplay">100%</span>
            </div>
          </div>
        </div>

        <div class="timeline-main">
          <!-- Layer Headers -->
          <div class="layer-headers" id="layerHeaders">
            <div class="layer-header-ruler">
              <!-- 레이어 추가/삭제 버튼 -->
              <button class="layer-action-btn" id="btnAddLayer" title="레이어 추가">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </button>
              <button class="layer-action-btn" id="btnDeleteLayer" title="레이어 삭제">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/></svg>
              </button>
            </div>
            <div class="layer-header" data-layer="video">
              <div class="layer-color" style="background: #3a3a3a"></div>
              <span class="layer-visibility">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
              </span>
              <span class="layer-name">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px"><rect x="2" y="2" width="20" height="20" rx="2.18"/><line x1="7" y1="2" x2="7" y2="22"/><line x1="17" y1="2" x2="17" y2="22"/><line x1="2" y1="12" x2="22" y2="12"/></svg>
                Video
              </span>
              <span class="layer-lock">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              </span>
            </div>
          </div>

          <!-- Timeline Tracks -->
          <div class="timeline-tracks" id="timelineTracks">
            <!-- 플레이헤드 (핸들 + 라인이 같은 부모에서 같은 left 값 사용) -->
            <div class="playhead-handle" id="playheadHandle"></div>
            <div class="playhead-line" id="playheadLine"></div>

            <div class="timeline-ruler" id="timelineRuler"></div>
            <div class="tracks-container" id="tracksContainer">
              <div class="track-row">
                <div class="track-clip video" id="videoTrackClip">영상을 로드하세요</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Resizer (Vertical) -->
    <div class="resizer" id="panelResizer">
      <!-- Comment Panel Toggle Button -->
      <button class="comment-panel-toggle" id="commentPanelToggle" title="댓글 패널 토글">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
      </button>
    </div>

    <!-- Comment Panel -->
    <div class="comment-panel" id="commentPanel">
      <div class="panel-header">
        <div class="panel-title">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="color: var(--accent-primary)"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          댓글
          <span class="comment-count" id="commentCount">0</span>
        </div>
        <div class="panel-actions">
          <button class="panel-btn" title="정렬">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>
          </button>
          <button class="panel-btn" id="btnCommentSettings" title="설정">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
          </button>
          <!-- 설정 드롭다운 -->
          <div class="comment-settings-dropdown" id="commentSettingsDropdown">
            <div class="settings-dropdown-header">댓글 설정</div>
            <div class="settings-dropdown-item">
              <label class="settings-toggle">
                <input type="checkbox" id="toggleCommentThumbnails" checked>
                <span class="toggle-slider"></span>
                <span class="toggle-label">썸네일 표시</span>
              </label>
            </div>
            <div class="settings-dropdown-item thumbnail-scale-item" id="thumbnailScaleItem">
              <label class="settings-label">썸네일 크기</label>
              <div class="settings-scale-control">
                <input type="range" id="thumbnailScaleSlider" min="50" max="200" value="50" step="10">
                <span class="scale-value" id="thumbnailScaleValue">50%</span>
              </div>
            </div>
            <div class="settings-dropdown-divider"></div>
            <button class="settings-dropdown-btn" id="btnChangeUserName">
              <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              이름 변경
            </button>
          </div>
        </div>
      </div>

      <div class="filter-bar">
        <button class="filter-chip active" data-filter="all">전체</button>
        <button class="filter-chip" data-filter="unresolved">미해결</button>
        <button class="filter-chip" data-filter="resolved">해결됨</button>
      </div>

      <div class="comments-list" id="commentsList">
        <!-- 댓글들이 여기에 렌더링됨 -->
        <div class="empty-comments">
          <div class="empty-comments-icon">
            <svg viewBox="0 0 24 24" width="40" height="40" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
          </div>
          <div class="empty-comments-text">아직 댓글이 없습니다</div>
          <div class="empty-comments-hint">영상을 재생하고 C키를 눌러 댓글을 추가하세요</div>
        </div>
      </div>

      <!-- New Comment Input -->
      <div class="new-comment">
        <div class="comment-input-wrapper">
          <textarea class="comment-input" id="commentInput" rows="2" placeholder="댓글을 입력하세요..."></textarea>
          <button class="comment-submit" id="btnSubmitComment">전송</button>
        </div>
        <div class="input-hint">Tip: 그리기 도구(D)로 마킹을 추가하면 더 명확한 피드백을 줄 수 있어요</div>
      </div>
    </div>
  </div>

  <!-- Shortcuts Toggle Button -->
  <button class="shortcuts-toggle" id="shortcutsToggle" title="단축키 (?)">
    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="6" y1="8" x2="6.01" y2="8"/><line x1="10" y1="8" x2="10.01" y2="8"/><line x1="14" y1="8" x2="14.01" y2="8"/><line x1="18" y1="8" x2="18.01" y2="8"/><line x1="6" y1="12" x2="6.01" y2="12"/><line x1="10" y1="12" x2="10.01" y2="12"/><line x1="14" y1="12" x2="14.01" y2="12"/><line x1="18" y1="12" x2="18.01" y2="12"/><line x1="6" y1="16" x2="18" y2="16"/></svg>
  </button>

  <!-- Shortcuts Menu -->
  <div class="shortcuts-menu" id="shortcutsMenu">
    <div class="shortcuts-menu-header">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="6" y1="8" x2="6.01" y2="8"/><line x1="10" y1="8" x2="10.01" y2="8"/><line x1="14" y1="8" x2="14.01" y2="8"/><line x1="18" y1="8" x2="18.01" y2="8"/><line x1="6" y1="12" x2="6.01" y2="12"/><line x1="10" y1="12" x2="10.01" y2="12"/><line x1="14" y1="12" x2="14.01" y2="12"/><line x1="18" y1="12" x2="18.01" y2="12"/><line x1="6" y1="16" x2="18" y2="16"/></svg>
      키보드 단축키
    </div>
    <!-- 단축키 세트 선택 -->
    <div class="shortcut-set-selector">
      <button class="shortcut-set-btn" data-set="set1" id="shortcutSet1">Set 1 (기본)</button>
      <button class="shortcut-set-btn active" data-set="set2" id="shortcutSet2">Set 2 (애니)</button>
    </div>
    <div class="shortcuts-menu-content">
      <!-- 공통 단축키 -->
      <div class="shortcut-category">
        <div class="shortcut-category-title">재생 (공통)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">재생/정지</span>
          <div class="shortcut-keys"><span class="shortcut-key">Space</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">이전/다음 프레임</span>
          <div class="shortcut-keys"><span class="shortcut-key">←</span><span class="shortcut-key">→</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">1초 이동</span>
          <div class="shortcut-keys"><span class="shortcut-key">Shift</span><span class="shortcut-key">←→</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">처음/끝으로</span>
          <div class="shortcut-keys"><span class="shortcut-key">Home</span><span class="shortcut-key">End</span></div>
        </div>
      </div>

      <!-- Set 1 전용 단축키 -->
      <div class="shortcut-category shortcut-set1-only">
        <div class="shortcut-category-title">도구 (Set 1)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">그리기 모드 토글</span>
          <div class="shortcut-keys"><span class="shortcut-key">D</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">댓글 추가</span>
          <div class="shortcut-keys"><span class="shortcut-key">C</span></div>
        </div>
      </div>

      <!-- Set 2 전용 단축키 -->
      <div class="shortcut-category shortcut-set2-only">
        <div class="shortcut-category-title">탐색 (Set 2)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">1프레임 이전/다음</span>
          <div class="shortcut-keys"><span class="shortcut-key">Shift</span><span class="shortcut-key">A/D</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">이전/다음 키프레임</span>
          <div class="shortcut-keys"><span class="shortcut-key">A</span><span class="shortcut-key">D</span></div>
        </div>
      </div>
      <div class="shortcut-category shortcut-set2-only">
        <div class="shortcut-category-title">도구 (Set 2)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">브러시 모드 (그리기)</span>
          <div class="shortcut-keys"><span class="shortcut-key">B</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">선택 모드 (그리기 해제)</span>
          <div class="shortcut-keys"><span class="shortcut-key">V</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">댓글 추가</span>
          <div class="shortcut-keys"><span class="shortcut-key">C</span></div>
        </div>
      </div>
      <div class="shortcut-category shortcut-set2-only">
        <div class="shortcut-category-title">키프레임 (Set 2, 그리기 모드)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">어니언 스킨 토글</span>
          <div class="shortcut-keys"><span class="shortcut-key">1</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">빈 키프레임 삽입</span>
          <div class="shortcut-keys"><span class="shortcut-key">2</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">프레임 삽입 (홀드)</span>
          <div class="shortcut-keys"><span class="shortcut-key">3</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">프레임 삭제</span>
          <div class="shortcut-keys"><span class="shortcut-key">4</span></div>
        </div>
      </div>

      <!-- 공통 도구 -->
      <div class="shortcut-category">
        <div class="shortcut-category-title">편집 (공통)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">실행 취소</span>
          <div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">Z</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">다시 실행</span>
          <div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">Y</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">키프레임 복제 추가</span>
          <div class="shortcut-keys"><span class="shortcut-key">F6</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">빈 키프레임 추가</span>
          <div class="shortcut-keys"><span class="shortcut-key">F7</span></div>
        </div>
      </div>
      <div class="shortcut-category">
        <div class="shortcut-category-title">보기 (공통)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">타임라인 줌</span>
          <div class="shortcut-keys"><span class="shortcut-key">Ctrl</span><span class="shortcut-key">+/-</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">단축키 메뉴</span>
          <div class="shortcut-keys"><span class="shortcut-key">?</span></div>
        </div>
      </div>
      <div class="shortcut-category">
        <div class="shortcut-category-title">구간 반복 (공통)</div>
        <div class="shortcut-row">
          <span class="shortcut-label">시작점 설정</span>
          <div class="shortcut-keys"><span class="shortcut-key">I</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">종료점 설정</span>
          <div class="shortcut-keys"><span class="shortcut-key">O</span></div>
        </div>
        <div class="shortcut-row">
          <span class="shortcut-label">구간 반복 토글</span>
          <div class="shortcut-keys"><span class="shortcut-key">L</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Scripts -->
  <!-- User Settings Modal -->
  <div class="modal-overlay" id="userSettingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>사용자 설정</h3>
        <button class="modal-close" id="closeUserSettings">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="userNameInput">표시 이름</label>
          <input type="text" id="userNameInput" placeholder="댓글에 표시될 이름을 입력하세요" maxlength="20">
          <p class="form-hint">이 이름은 댓글 작성 시 표시됩니다.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" id="cancelUserSettings">취소</button>
        <button class="btn-primary" id="saveUserSettings">저장</button>
      </div>
    </div>
  </div>

  <!-- Credits Modal -->
  <div class="credits-overlay" id="creditsOverlay">
    <canvas class="credits-plexus" id="creditsPlexus"></canvas>
    <div class="credits-modal">
      <button class="credits-close" id="creditsClose">
        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
      <div class="credits-content">
        <img class="credits-logo-img" src="assets/logo/baeframe.png" alt="BAEFRAME">
        <div class="credits-logo">
          <span class="credits-logo-b">B</span>
          <span class="credits-logo-text">AE Frame.</span>
        </div>
        <div class="credits-studio">
          <span class="credits-studio-label">Studio</span>
          <span class="credits-studio-name">JBBJ</span>
        </div>
        <div class="credits-divider"></div>
        <div class="credits-people">
          <div class="credits-person">
            <span class="credits-role">powered by</span>
            <span class="credits-name">_배한솔</span>
          </div>
          <div class="credits-person">
            <span class="credits-role">thanks to</span>
            <span class="credits-name">_윤성원</span>
          </div>
        </div>
        <div class="credits-version" id="creditsVersion">v1.0.0</div>
      </div>
    </div>
  </div>

  <!-- Thread Popup Modal -->
  <div class="thread-overlay" id="threadOverlay">
    <div class="thread-modal">
      <div class="thread-header">
        <button class="thread-back" id="threadBack">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"/>
          </svg>
        </button>
        <div class="thread-title">
          <span class="thread-title-text">스레드</span>
          <span class="thread-author" id="threadAuthor"></span>
        </div>
        <div class="thread-actions">
          <button class="thread-action-btn" title="설정">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/>
            </svg>
          </button>
          <button class="thread-close" id="threadClose">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="thread-content" id="threadContent">
        <!-- 원본 댓글 -->
        <div class="thread-original" id="threadOriginal"></div>

        <!-- 답글 개수 -->
        <div class="thread-reply-count" id="threadReplyCount"></div>

        <!-- 답글들 -->
        <div class="thread-replies" id="threadReplies"></div>
      </div>

      <!-- 답글 입력 -->
      <div class="thread-input-area">
        <div class="thread-editor-toolbar">
          <button class="editor-btn" data-format="bold" title="굵게 (Ctrl+B)">
            <strong>B</strong>
          </button>
          <button class="editor-btn" data-format="italic" title="기울임 (Ctrl+I)">
            <em>I</em>
          </button>
          <button class="editor-btn" data-format="underline" title="밑줄 (Ctrl+U)">
            <u>U</u>
          </button>
          <button class="editor-btn" data-format="strike" title="취소선">
            <s>S</s>
          </button>
          <span class="editor-divider"></span>
          <button class="editor-btn" data-format="link" title="링크">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
            </svg>
          </button>
          <span class="editor-divider"></span>
          <button class="editor-btn" data-format="bullet" title="목록">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/>
              <circle cx="4" cy="6" r="1" fill="currentColor"/><circle cx="4" cy="12" r="1" fill="currentColor"/><circle cx="4" cy="18" r="1" fill="currentColor"/>
            </svg>
          </button>
          <button class="editor-btn" data-format="numbered" title="번호 목록">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="10" y1="6" x2="21" y2="6"/><line x1="10" y1="12" x2="21" y2="12"/><line x1="10" y1="18" x2="21" y2="18"/>
              <text x="2" y="8" font-size="8" fill="currentColor">1</text>
              <text x="2" y="14" font-size="8" fill="currentColor">2</text>
              <text x="2" y="20" font-size="8" fill="currentColor">3</text>
            </svg>
          </button>
          <span class="editor-divider"></span>
          <button class="editor-btn" data-format="code" title="코드">
            &lt;/&gt;
          </button>
          <button class="editor-btn" data-format="codeblock" title="코드 블록">
            <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2"/>
              <polyline points="8 10 5 12 8 14"/><polyline points="16 10 19 12 16 14"/>
            </svg>
          </button>
        </div>
        <div class="thread-editor-wrapper">
          <div class="thread-editor"
               id="threadEditor"
               contenteditable="true"
               data-placeholder="댓글 남기기..."></div>
        </div>
        <div class="thread-input-footer">
          <div></div>
          <button class="thread-submit" id="threadSubmit">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Web Share Modal -->
  <div class="modal-overlay" id="webShareModal">
    <div class="modal-content web-share-modal">
      <div class="modal-header">
        <h3>🌐 웹 공유 링크 생성</h3>
        <button class="modal-close" id="closeWebShare">&times;</button>
      </div>
      <div class="modal-body">
        <!-- 현재 파일 정보 (Google Drive인 경우) -->
        <div id="webShareFileInfo" class="web-share-file-info" style="display: none;"></div>

        <!-- 클립보드에서 붙여넣기 버튼 (핵심 기능) -->
        <div class="form-group" style="margin-bottom: 16px;">
          <button class="btn btn-primary btn-full btn-large" id="pasteFromClipboard">
            📋 클립보드에서 붙여넣기
          </button>
          <p class="form-hint" style="text-align: center; margin-top: 8px;">
            파일 탐색기에서 링크를 복사한 후 이 버튼을 누르세요
          </p>
        </div>

        <hr style="border-color: #333; margin: 16px 0;">

        <div class="form-group">
          <label for="webShareVideoUrl">1️⃣ 영상 파일 URL</label>
          <input type="text" id="webShareVideoUrl" placeholder="Google Drive 링크 붙여넣기..." style="transition: border-color 0.2s;">
        </div>
        <div class="form-group">
          <label for="webShareBframeUrl">2️⃣ .bframe 파일 URL</label>
          <input type="text" id="webShareBframeUrl" placeholder="Google Drive 링크 붙여넣기..." style="transition: border-color 0.2s;">
        </div>
        <div class="form-group web-share-result" id="webShareResultGroup" style="display: none;">
          <label>생성된 웹 공유 링크</label>
          <div class="web-share-url-container">
            <input type="text" id="webShareResultUrl" readonly>
            <button class="btn btn-primary" id="btnCopyWebShareUrl">복사</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="cancelWebShare">취소</button>
        <button class="btn btn-primary" id="generateWebShareLink">링크 생성</button>
      </div>
    </div>
  </div>

  <script type="module" src="scripts/app.js"></script>
</body>
</html>
